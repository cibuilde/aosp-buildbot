
name: AOSP Build
on:
  push:
    branches:
    - main
env:
  branch: 'android-12.0.0_r1'
jobs:
  build_step4:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@main
    - uses: actions/setup-python@v4
      with:
        python-version: "2.7"
    - name: Download get_clang_version.py
      run: |
        curl "https://android.googlesource.com/platform/build/soong/+/refs/heads/master/scripts/get_clang_version.py?format=TEXT" | base64 -d > $GITHUB_WORKSPACE/get_clang_version.py
        mkdir -p aosp

    - name: Restore Cache build/make
      id: build_make
      uses: actions/cache@v3
      with:
        path: aosp/build/make
        key: build_make@${{ env.branch }}
        restore-keys: build_make@${{ env.branch }}
    - name: Clone project build/make
      if: steps.build_make.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform build
        mv build make && mkdir build && mv make build/
        sed -i 's/^PRODUCT_EXTRA_VNDK_VERSIONS/#PRODUCT_EXTRA_VNDK_VERSIONS/g' build/make/target/product/gsi_release.mk
    - name: Restore Cache art
      id: art
      uses: actions/cache@v3
      with:
        path: aosp/art
        key: art@${{ env.branch }}
        restore-keys: art@${{ env.branch }}
    - name: Clone project art
      if: steps.art.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform art
    - name: Restore Cache bionic
      id: bionic
      uses: actions/cache@v3
      with:
        path: aosp/bionic
        key: bionic@${{ env.branch }}
        restore-keys: bionic@${{ env.branch }}
    - name: Clone project bionic
      if: steps.bionic.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform bionic
    - name: Restore Cache bootable/recovery
      id: bootable_recovery
      uses: actions/cache@v3
      with:
        path: aosp/bootable/recovery
        key: bootable_recovery@${{ env.branch }}
        restore-keys: bootable_recovery@${{ env.branch }}
    - name: Clone project bootable/recovery
      if: steps.bootable_recovery.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform bootable/recovery
    - name: Restore Cache build/blueprint
      id: build_blueprint
      uses: actions/cache@v3
      with:
        path: aosp/build/blueprint
        key: build_blueprint@${{ env.branch }}
        restore-keys: build_blueprint@${{ env.branch }}
    - name: Clone project build/blueprint
      if: steps.build_blueprint.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform build/blueprint
    - name: Restore Cache build/soong
      id: build_soong
      uses: actions/cache@v3
      with:
        path: aosp/build/soong
        key: build_soong@${{ env.branch }}
        restore-keys: build_soong@${{ env.branch }}
    - name: Clone project build/soong
      if: steps.build_soong.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform build/soong
    - name: Restore Cache device/google/cuttlefish
      id: device_google_cuttlefish
      uses: actions/cache@v3
      with:
        path: aosp/device/google/cuttlefish
        key: device_google_cuttlefish@${{ env.branch }}
        restore-keys: device_google_cuttlefish@${{ env.branch }}
    - name: Clone project device/google/cuttlefish
      if: steps.device_google_cuttlefish.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth device/google/cuttlefish
    - name: Restore Cache external/OpenCSD
      id: external_OpenCSD
      uses: actions/cache@v3
      with:
        path: aosp/external/OpenCSD
        key: external_OpenCSD@${{ env.branch }}
        restore-keys: external_OpenCSD@${{ env.branch }}
    - name: Clone project external/OpenCSD
      if: steps.external_OpenCSD.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/OpenCSD
    - name: Restore Cache external/angle
      id: external_angle
      uses: actions/cache@v3
      with:
        path: aosp/external/angle
        key: external_angle@${{ env.branch }}
        restore-keys: external_angle@${{ env.branch }}
    - name: Clone project external/angle
      if: steps.external_angle.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/angle
    - name: Restore Cache external/bcc
      id: external_bcc
      uses: actions/cache@v3
      with:
        path: aosp/external/bcc
        key: external_bcc@${{ env.branch }}
        restore-keys: external_bcc@${{ env.branch }}
    - name: Clone project external/bcc
      if: steps.external_bcc.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/bcc
    - name: Restore Cache external/boringssl
      id: external_boringssl
      uses: actions/cache@v3
      with:
        path: aosp/external/boringssl
        key: external_boringssl@${{ env.branch }}
        restore-keys: external_boringssl@${{ env.branch }}
    - name: Clone project external/boringssl
      if: steps.external_boringssl.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/boringssl
    - name: Restore Cache external/brotli
      id: external_brotli
      uses: actions/cache@v3
      with:
        path: aosp/external/brotli
        key: external_brotli@${{ env.branch }}
        restore-keys: external_brotli@${{ env.branch }}
    - name: Clone project external/brotli
      if: steps.external_brotli.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/brotli
    - name: Restore Cache external/bsdiff
      id: external_bsdiff
      uses: actions/cache@v3
      with:
        path: aosp/external/bsdiff
        key: external_bsdiff@${{ env.branch }}
        restore-keys: external_bsdiff@${{ env.branch }}
    - name: Clone project external/bsdiff
      if: steps.external_bsdiff.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/bsdiff
    - name: Restore Cache external/cn-cbor
      id: external_cn-cbor
      uses: actions/cache@v3
      with:
        path: aosp/external/cn-cbor
        key: external_cn-cbor@${{ env.branch }}
        restore-keys: external_cn-cbor@${{ env.branch }}
    - name: Clone project external/cn-cbor
      if: steps.external_cn-cbor.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/cn-cbor
    - name: Restore Cache external/compiler-rt
      id: external_compiler-rt
      uses: actions/cache@v3
      with:
        path: aosp/external/compiler-rt
        key: external_compiler-rt@${{ env.branch }}
        restore-keys: external_compiler-rt@${{ env.branch }}
    - name: Clone project external/compiler-rt
      if: steps.external_compiler-rt.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/compiler-rt
    - name: Restore Cache external/cpu_features
      id: external_cpu_features
      uses: actions/cache@v3
      with:
        path: aosp/external/cpu_features
        key: external_cpu_features@${{ env.branch }}
        restore-keys: external_cpu_features@${{ env.branch }}
    - name: Clone project external/cpu_features
      if: steps.external_cpu_features.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/cpu_features
    - name: Restore Cache external/crosvm
      id: external_crosvm
      uses: actions/cache@v3
      with:
        path: aosp/external/crosvm
        key: external_crosvm@${{ env.branch }}
        restore-keys: external_crosvm@${{ env.branch }}
    - name: Clone project external/crosvm
      if: steps.external_crosvm.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/crosvm
    - name: Restore Cache external/drm_hwcomposer
      id: external_drm_hwcomposer
      uses: actions/cache@v3
      with:
        path: aosp/external/drm_hwcomposer
        key: external_drm_hwcomposer@${{ env.branch }}
        restore-keys: external_drm_hwcomposer@${{ env.branch }}
    - name: Clone project external/drm_hwcomposer
      if: steps.external_drm_hwcomposer.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/drm_hwcomposer
    - name: Restore Cache external/dtc
      id: external_dtc
      uses: actions/cache@v3
      with:
        path: aosp/external/dtc
        key: external_dtc@${{ env.branch }}
        restore-keys: external_dtc@${{ env.branch }}
    - name: Clone project external/dtc
      if: steps.external_dtc.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/dtc
    - name: Restore Cache external/e2fsprogs
      id: external_e2fsprogs
      uses: actions/cache@v3
      with:
        path: aosp/external/e2fsprogs
        key: external_e2fsprogs@${{ env.branch }}
        restore-keys: external_e2fsprogs@${{ env.branch }}
    - name: Clone project external/e2fsprogs
      if: steps.external_e2fsprogs.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/e2fsprogs
    - name: Restore Cache external/eigen
      id: external_eigen
      uses: actions/cache@v3
      with:
        path: aosp/external/eigen
        key: external_eigen@${{ env.branch }}
        restore-keys: external_eigen@${{ env.branch }}
    - name: Clone project external/eigen
      if: steps.external_eigen.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/eigen
    - name: Restore Cache external/f2fs-tools
      id: external_f2fs-tools
      uses: actions/cache@v3
      with:
        path: aosp/external/f2fs-tools
        key: external_f2fs-tools@${{ env.branch }}
        restore-keys: external_f2fs-tools@${{ env.branch }}
    - name: Clone project external/f2fs-tools
      if: steps.external_f2fs-tools.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/f2fs-tools
    - name: Restore Cache external/fdlibm
      id: external_fdlibm
      uses: actions/cache@v3
      with:
        path: aosp/external/fdlibm
        key: external_fdlibm@${{ env.branch }}
        restore-keys: external_fdlibm@${{ env.branch }}
    - name: Clone project external/fdlibm
      if: steps.external_fdlibm.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/fdlibm
    - name: Restore Cache external/fec
      id: external_fec
      uses: actions/cache@v3
      with:
        path: aosp/external/fec
        key: external_fec@${{ env.branch }}
        restore-keys: external_fec@${{ env.branch }}
    - name: Clone project external/fec
      if: steps.external_fec.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/fec
    - name: Restore Cache external/flac
      id: external_flac
      uses: actions/cache@v3
      with:
        path: aosp/external/flac
        key: external_flac@${{ env.branch }}
        restore-keys: external_flac@${{ env.branch }}
    - name: Clone project external/flac
      if: steps.external_flac.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/flac
    - name: Restore Cache external/flatbuffers
      id: external_flatbuffers
      uses: actions/cache@v3
      with:
        path: aosp/external/flatbuffers
        key: external_flatbuffers@${{ env.branch }}
        restore-keys: external_flatbuffers@${{ env.branch }}
    - name: Clone project external/flatbuffers
      if: steps.external_flatbuffers.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/flatbuffers
    - name: Restore Cache external/fmtlib
      id: external_fmtlib
      uses: actions/cache@v3
      with:
        path: aosp/external/fmtlib
        key: external_fmtlib@${{ env.branch }}
        restore-keys: external_fmtlib@${{ env.branch }}
    - name: Clone project external/fmtlib
      if: steps.external_fmtlib.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/fmtlib
    - name: Restore Cache external/freetype
      id: external_freetype
      uses: actions/cache@v3
      with:
        path: aosp/external/freetype
        key: external_freetype@${{ env.branch }}
        restore-keys: external_freetype@${{ env.branch }}
    - name: Clone project external/freetype
      if: steps.external_freetype.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/freetype
    - name: Restore Cache external/fsck_msdos
      id: external_fsck_msdos
      uses: actions/cache@v3
      with:
        path: aosp/external/fsck_msdos
        key: external_fsck_msdos@${{ env.branch }}
        restore-keys: external_fsck_msdos@${{ env.branch }}
    - name: Clone project external/fsck_msdos
      if: steps.external_fsck_msdos.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/fsck_msdos
    - name: Restore Cache external/gemmlowp
      id: external_gemmlowp
      uses: actions/cache@v3
      with:
        path: aosp/external/gemmlowp
        key: external_gemmlowp@${{ env.branch }}
        restore-keys: external_gemmlowp@${{ env.branch }}
    - name: Clone project external/gemmlowp
      if: steps.external_gemmlowp.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/gemmlowp
    - name: Restore Cache external/gflags
      id: external_gflags
      uses: actions/cache@v3
      with:
        path: aosp/external/gflags
        key: external_gflags@${{ env.branch }}
        restore-keys: external_gflags@${{ env.branch }}
    - name: Clone project external/gflags
      if: steps.external_gflags.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/gflags
    - name: Restore Cache external/giflib
      id: external_giflib
      uses: actions/cache@v3
      with:
        path: aosp/external/giflib
        key: external_giflib@${{ env.branch }}
        restore-keys: external_giflib@${{ env.branch }}
    - name: Clone project external/giflib
      if: steps.external_giflib.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/giflib
    - name: Restore Cache external/golang-protobuf
      id: external_golang-protobuf
      uses: actions/cache@v3
      with:
        path: aosp/external/golang-protobuf
        key: external_golang-protobuf@${{ env.branch }}
        restore-keys: external_golang-protobuf@${{ env.branch }}
    - name: Clone project external/golang-protobuf
      if: steps.external_golang-protobuf.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/golang-protobuf
    - name: Restore Cache external/google-fruit
      id: external_google-fruit
      uses: actions/cache@v3
      with:
        path: aosp/external/google-fruit
        key: external_google-fruit@${{ env.branch }}
        restore-keys: external_google-fruit@${{ env.branch }}
    - name: Clone project external/google-fruit
      if: steps.external_google-fruit.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/google-fruit
    - name: Restore Cache external/googletest
      id: external_googletest
      uses: actions/cache@v3
      with:
        path: aosp/external/googletest
        key: external_googletest@${{ env.branch }}
        restore-keys: external_googletest@${{ env.branch }}
    - name: Clone project external/googletest
      if: steps.external_googletest.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/googletest
    - name: Restore Cache external/grpc-grpc
      id: external_grpc-grpc
      uses: actions/cache@v3
      with:
        path: aosp/external/grpc-grpc
        key: external_grpc-grpc@${{ env.branch }}
        restore-keys: external_grpc-grpc@${{ env.branch }}
    - name: Clone project external/grpc-grpc
      if: steps.external_grpc-grpc.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/grpc-grpc
    - name: Restore Cache external/gwp_asan
      id: external_gwp_asan
      uses: actions/cache@v3
      with:
        path: aosp/external/gwp_asan
        key: external_gwp_asan@${{ env.branch }}
        restore-keys: external_gwp_asan@${{ env.branch }}
    - name: Clone project external/gwp_asan
      if: steps.external_gwp_asan.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/gwp_asan
    - name: Restore Cache external/icu
      id: external_icu
      uses: actions/cache@v3
      with:
        path: aosp/external/icu
        key: external_icu@${{ env.branch }}
        restore-keys: external_icu@${{ env.branch }}
    - name: Clone project external/icu
      if: steps.external_icu.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/icu
    - name: Restore Cache external/iperf3
      id: external_iperf3
      uses: actions/cache@v3
      with:
        path: aosp/external/iperf3
        key: external_iperf3@${{ env.branch }}
        restore-keys: external_iperf3@${{ env.branch }}
    - name: Clone project external/iperf3
      if: steps.external_iperf3.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/iperf3
    - name: Restore Cache external/iproute2
      id: external_iproute2
      uses: actions/cache@v3
      with:
        path: aosp/external/iproute2
        key: external_iproute2@${{ env.branch }}
        restore-keys: external_iproute2@${{ env.branch }}
    - name: Clone project external/iproute2
      if: steps.external_iproute2.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/iproute2
    - name: Restore Cache external/ipsec-tools
      id: external_ipsec-tools
      uses: actions/cache@v3
      with:
        path: aosp/external/ipsec-tools
        key: external_ipsec-tools@${{ env.branch }}
        restore-keys: external_ipsec-tools@${{ env.branch }}
    - name: Clone project external/ipsec-tools
      if: steps.external_ipsec-tools.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/ipsec-tools
    - name: Restore Cache external/iptables
      id: external_iptables
      uses: actions/cache@v3
      with:
        path: aosp/external/iptables
        key: external_iptables@${{ env.branch }}
        restore-keys: external_iptables@${{ env.branch }}
    - name: Clone project external/iptables
      if: steps.external_iptables.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/iptables
    - name: Restore Cache external/iputils
      id: external_iputils
      uses: actions/cache@v3
      with:
        path: aosp/external/iputils
        key: external_iputils@${{ env.branch }}
        restore-keys: external_iputils@${{ env.branch }}
    - name: Clone project external/iputils
      if: steps.external_iputils.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/iputils
    - name: Restore Cache external/jsmn
      id: external_jsmn
      uses: actions/cache@v3
      with:
        path: aosp/external/jsmn
        key: external_jsmn@${{ env.branch }}
        restore-keys: external_jsmn@${{ env.branch }}
    - name: Clone project external/jsmn
      if: steps.external_jsmn.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/jsmn
    - name: Restore Cache external/jsoncpp
      id: external_jsoncpp
      uses: actions/cache@v3
      with:
        path: aosp/external/jsoncpp
        key: external_jsoncpp@${{ env.branch }}
        restore-keys: external_jsoncpp@${{ env.branch }}
    - name: Clone project external/jsoncpp
      if: steps.external_jsoncpp.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/jsoncpp
    - name: Restore Cache external/kmod
      id: external_kmod
      uses: actions/cache@v3
      with:
        path: aosp/external/kmod
        key: external_kmod@${{ env.branch }}
        restore-keys: external_kmod@${{ env.branch }}
    - name: Clone project external/kmod
      if: steps.external_kmod.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/kmod
    - name: Restore Cache external/libcap
      id: external_libcap
      uses: actions/cache@v3
      with:
        path: aosp/external/libcap
        key: external_libcap@${{ env.branch }}
        restore-keys: external_libcap@${{ env.branch }}
    - name: Clone project external/libcap
      if: steps.external_libcap.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/libcap
    - name: Restore Cache external/libdivsufsort
      id: external_libdivsufsort
      uses: actions/cache@v3
      with:
        path: aosp/external/libdivsufsort
        key: external_libdivsufsort@${{ env.branch }}
        restore-keys: external_libdivsufsort@${{ env.branch }}
    - name: Clone project external/libdivsufsort
      if: steps.external_libdivsufsort.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/libdivsufsort
    - name: Restore Cache external/libdrm
      id: external_libdrm
      uses: actions/cache@v3
      with:
        path: aosp/external/libdrm
        key: external_libdrm@${{ env.branch }}
        restore-keys: external_libdrm@${{ env.branch }}
    - name: Clone project external/libdrm
      if: steps.external_libdrm.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/libdrm
    - name: Restore Cache external/libepoxy
      id: external_libepoxy
      uses: actions/cache@v3
      with:
        path: aosp/external/libepoxy
        key: external_libepoxy@${{ env.branch }}
        restore-keys: external_libepoxy@${{ env.branch }}
    - name: Clone project external/libepoxy
      if: steps.external_libepoxy.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/libepoxy
    - name: Restore Cache external/libevent
      id: external_libevent
      uses: actions/cache@v3
      with:
        path: aosp/external/libevent
        key: external_libevent@${{ env.branch }}
        restore-keys: external_libevent@${{ env.branch }}
    - name: Clone project external/libevent
      if: steps.external_libevent.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/libevent
    - name: Restore Cache external/libffi
      id: external_libffi
      uses: actions/cache@v3
      with:
        path: aosp/external/libffi
        key: external_libffi@${{ env.branch }}
        restore-keys: external_libffi@${{ env.branch }}
    - name: Clone project external/libffi
      if: steps.external_libffi.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/libffi
    - name: Restore Cache external/libgav1
      id: external_libgav1
      uses: actions/cache@v3
      with:
        path: aosp/external/libgav1
        key: external_libgav1@${{ env.branch }}
        restore-keys: external_libgav1@${{ env.branch }}
    - name: Clone project external/libgav1
      if: steps.external_libgav1.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/libgav1
    - name: Restore Cache external/libgsm
      id: external_libgsm
      uses: actions/cache@v3
      with:
        path: aosp/external/libgsm
        key: external_libgsm@${{ env.branch }}
        restore-keys: external_libgsm@${{ env.branch }}
    - name: Clone project external/libgsm
      if: steps.external_libgsm.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/libgsm
    - name: Restore Cache external/libhevc
      id: external_libhevc
      uses: actions/cache@v3
      with:
        path: aosp/external/libhevc
        key: external_libhevc@${{ env.branch }}
        restore-keys: external_libhevc@${{ env.branch }}
    - name: Clone project external/libhevc
      if: steps.external_libhevc.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/libhevc
    - name: Restore Cache external/libjpeg-turbo
      id: external_libjpeg-turbo
      uses: actions/cache@v3
      with:
        path: aosp/external/libjpeg-turbo
        key: external_libjpeg-turbo@${{ env.branch }}
        restore-keys: external_libjpeg-turbo@${{ env.branch }}
    - name: Clone project external/libjpeg-turbo
      if: steps.external_libjpeg-turbo.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/libjpeg-turbo
    - name: Restore Cache external/libldac
      id: external_libldac
      uses: actions/cache@v3
      with:
        path: aosp/external/libldac
        key: external_libldac@${{ env.branch }}
        restore-keys: external_libldac@${{ env.branch }}
    - name: Clone project external/libldac
      if: steps.external_libldac.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/libldac
    - name: Restore Cache external/libnl
      id: external_libnl
      uses: actions/cache@v3
      with:
        path: aosp/external/libnl
        key: external_libnl@${{ env.branch }}
        restore-keys: external_libnl@${{ env.branch }}
    - name: Clone project external/libnl
      if: steps.external_libnl.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/libnl
    - name: Restore Cache external/libogg
      id: external_libogg
      uses: actions/cache@v3
      with:
        path: aosp/external/libogg
        key: external_libogg@${{ env.branch }}
        restore-keys: external_libogg@${{ env.branch }}
    - name: Clone project external/libogg
      if: steps.external_libogg.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/libogg
    - name: Restore Cache external/libopus
      id: external_libopus
      uses: actions/cache@v3
      with:
        path: aosp/external/libopus
        key: external_libopus@${{ env.branch }}
        restore-keys: external_libopus@${{ env.branch }}
    - name: Clone project external/libopus
      if: steps.external_libopus.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/libopus
    - name: Restore Cache external/libpcap
      id: external_libpcap
      uses: actions/cache@v3
      with:
        path: aosp/external/libpcap
        key: external_libpcap@${{ env.branch }}
        restore-keys: external_libpcap@${{ env.branch }}
    - name: Clone project external/libpcap
      if: steps.external_libpcap.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/libpcap
    - name: Restore Cache external/libpng
      id: external_libpng
      uses: actions/cache@v3
      with:
        path: aosp/external/libpng
        key: external_libpng@${{ env.branch }}
        restore-keys: external_libpng@${{ env.branch }}
    - name: Clone project external/libpng
      if: steps.external_libpng.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/libpng
    - name: Restore Cache external/libtextclassifier
      id: external_libtextclassifier
      uses: actions/cache@v3
      with:
        path: aosp/external/libtextclassifier
        key: external_libtextclassifier@${{ env.branch }}
        restore-keys: external_libtextclassifier@${{ env.branch }}
    - name: Clone project external/libtextclassifier
      if: steps.external_libtextclassifier.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/libtextclassifier
    - name: Restore Cache external/libvpx
      id: external_libvpx
      uses: actions/cache@v3
      with:
        path: aosp/external/libvpx
        key: external_libvpx@${{ env.branch }}
        restore-keys: external_libvpx@${{ env.branch }}
    - name: Clone project external/libvpx
      if: steps.external_libvpx.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/libvpx
    - name: Restore Cache external/llvm
      id: external_llvm
      uses: actions/cache@v3
      with:
        path: aosp/external/llvm
        key: external_llvm@${{ env.branch }}
        restore-keys: external_llvm@${{ env.branch }}
    - name: Clone project external/llvm
      if: steps.external_llvm.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/llvm
    - name: Restore Cache external/lz4
      id: external_lz4
      uses: actions/cache@v3
      with:
        path: aosp/external/lz4
        key: external_lz4@${{ env.branch }}
        restore-keys: external_lz4@${{ env.branch }}
    - name: Clone project external/lz4
      if: steps.external_lz4.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/lz4
    - name: Restore Cache external/minijail
      id: external_minijail
      uses: actions/cache@v3
      with:
        path: aosp/external/minijail
        key: external_minijail@${{ env.branch }}
        restore-keys: external_minijail@${{ env.branch }}
    - name: Clone project external/minijail
      if: steps.external_minijail.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/minijail
    - name: Restore Cache external/modp_b64
      id: external_modp_b64
      uses: actions/cache@v3
      with:
        path: aosp/external/modp_b64
        key: external_modp_b64@${{ env.branch }}
        restore-keys: external_modp_b64@${{ env.branch }}
    - name: Clone project external/modp_b64
      if: steps.external_modp_b64.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/modp_b64
    - name: Restore Cache external/nanopb-c
      id: external_nanopb-c
      uses: actions/cache@v3
      with:
        path: aosp/external/nanopb-c
        key: external_nanopb-c@${{ env.branch }}
        restore-keys: external_nanopb-c@${{ env.branch }}
    - name: Clone project external/nanopb-c
      if: steps.external_nanopb-c.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/nanopb-c
    - name: Restore Cache external/newfs_msdos
      id: external_newfs_msdos
      uses: actions/cache@v3
      with:
        path: aosp/external/newfs_msdos
        key: external_newfs_msdos@${{ env.branch }}
        restore-keys: external_newfs_msdos@${{ env.branch }}
    - name: Clone project external/newfs_msdos
      if: steps.external_newfs_msdos.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/newfs_msdos
    - name: Restore Cache external/oj-libjdwp
      id: external_oj-libjdwp
      uses: actions/cache@v3
      with:
        path: aosp/external/oj-libjdwp
        key: external_oj-libjdwp@${{ env.branch }}
        restore-keys: external_oj-libjdwp@${{ env.branch }}
    - name: Clone project external/oj-libjdwp
      if: steps.external_oj-libjdwp.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/oj-libjdwp
    - name: Restore Cache external/parameter-framework
      id: external_parameter-framework
      uses: actions/cache@v3
      with:
        path: aosp/external/parameter-framework
        key: external_parameter-framework@${{ env.branch }}
        restore-keys: external_parameter-framework@${{ env.branch }}
    - name: Clone project external/parameter-framework
      if: steps.external_parameter-framework.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/parameter-framework
    - name: Restore Cache external/pdfium
      id: external_pdfium
      uses: actions/cache@v3
      with:
        path: aosp/external/pdfium
        key: external_pdfium@${{ env.branch }}
        restore-keys: external_pdfium@${{ env.branch }}
    - name: Clone project external/pdfium
      if: steps.external_pdfium.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/pdfium
    - name: Restore Cache external/pffft
      id: external_pffft
      uses: actions/cache@v3
      with:
        path: aosp/external/pffft
        key: external_pffft@${{ env.branch }}
        restore-keys: external_pffft@${{ env.branch }}
    - name: Clone project external/pffft
      if: steps.external_pffft.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/pffft
    - name: Restore Cache external/piex
      id: external_piex
      uses: actions/cache@v3
      with:
        path: aosp/external/piex
        key: external_piex@${{ env.branch }}
        restore-keys: external_piex@${{ env.branch }}
    - name: Clone project external/piex
      if: steps.external_piex.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/piex
    - name: Restore Cache external/ppp
      id: external_ppp
      uses: actions/cache@v3
      with:
        path: aosp/external/ppp
        key: external_ppp@${{ env.branch }}
        restore-keys: external_ppp@${{ env.branch }}
    - name: Clone project external/ppp
      if: steps.external_ppp.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/ppp
    - name: Restore Cache external/python/cpython2
      id: external_python_cpython2
      uses: actions/cache@v3
      with:
        path: aosp/external/python/cpython2
        key: external_python_cpython2@${{ env.branch }}
        restore-keys: external_python_cpython2@${{ env.branch }}
    - name: Clone project external/python/cpython2
      if: steps.external_python_cpython2.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/python/cpython2
    - name: Restore Cache external/rnnoise
      id: external_rnnoise
      uses: actions/cache@v3
      with:
        path: aosp/external/rnnoise
        key: external_rnnoise@${{ env.branch }}
        restore-keys: external_rnnoise@${{ env.branch }}
    - name: Clone project external/rnnoise
      if: steps.external_rnnoise.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rnnoise
    - name: Restore Cache external/rust/crates/async-trait
      id: external_rust_crates_async-trait
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/async-trait
        key: external_rust_crates_async-trait@${{ env.branch }}
        restore-keys: external_rust_crates_async-trait@${{ env.branch }}
    - name: Clone project external/rust/crates/async-trait
      if: steps.external_rust_crates_async-trait.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/async-trait
    - name: Restore Cache external/rust/crates/futures-macro
      id: external_rust_crates_futures-macro
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/futures-macro
        key: external_rust_crates_futures-macro@${{ env.branch }}
        restore-keys: external_rust_crates_futures-macro@${{ env.branch }}
    - name: Clone project external/rust/crates/futures-macro
      if: steps.external_rust_crates_futures-macro.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/futures-macro
    - name: Restore Cache external/rust/crates/num-derive
      id: external_rust_crates_num-derive
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/num-derive
        key: external_rust_crates_num-derive@${{ env.branch }}
        restore-keys: external_rust_crates_num-derive@${{ env.branch }}
    - name: Clone project external/rust/crates/num-derive
      if: steps.external_rust_crates_num-derive.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/num-derive
    - name: Restore Cache external/rust/crates/proc-macro-error
      id: external_rust_crates_proc-macro-error
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/proc-macro-error
        key: external_rust_crates_proc-macro-error@${{ env.branch }}
        restore-keys: external_rust_crates_proc-macro-error@${{ env.branch }}
    - name: Clone project external/rust/crates/proc-macro-error
      if: steps.external_rust_crates_proc-macro-error.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/proc-macro-error
    - name: Restore Cache external/rust/crates/remain
      id: external_rust_crates_remain
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/remain
        key: external_rust_crates_remain@${{ env.branch }}
        restore-keys: external_rust_crates_remain@${{ env.branch }}
    - name: Clone project external/rust/crates/remain
      if: steps.external_rust_crates_remain.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/remain
    - name: Restore Cache external/rust/crates/serde_derive
      id: external_rust_crates_serde_derive
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/serde_derive
        key: external_rust_crates_serde_derive@${{ env.branch }}
        restore-keys: external_rust_crates_serde_derive@${{ env.branch }}
    - name: Clone project external/rust/crates/serde_derive
      if: steps.external_rust_crates_serde_derive.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/serde_derive
    - name: Restore Cache external/rust/crates/thiserror-impl
      id: external_rust_crates_thiserror-impl
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/thiserror-impl
        key: external_rust_crates_thiserror-impl@${{ env.branch }}
        restore-keys: external_rust_crates_thiserror-impl@${{ env.branch }}
    - name: Clone project external/rust/crates/thiserror-impl
      if: steps.external_rust_crates_thiserror-impl.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/thiserror-impl
    - name: Restore Cache external/rust/crates/tokio-macros
      id: external_rust_crates_tokio-macros
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/tokio-macros
        key: external_rust_crates_tokio-macros@${{ env.branch }}
        restore-keys: external_rust_crates_tokio-macros@${{ env.branch }}
    - name: Clone project external/rust/crates/tokio-macros
      if: steps.external_rust_crates_tokio-macros.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/tokio-macros
    - name: Restore Cache external/rust/cxx
      id: external_rust_cxx
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/cxx
        key: external_rust_cxx@${{ env.branch }}
        restore-keys: external_rust_cxx@${{ env.branch }}
    - name: Clone project external/rust/cxx
      if: steps.external_rust_cxx.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/cxx
    - name: Restore Cache external/selinux
      id: external_selinux
      uses: actions/cache@v3
      with:
        path: aosp/external/selinux
        key: external_selinux@${{ env.branch }}
        restore-keys: external_selinux@${{ env.branch }}
    - name: Clone project external/selinux
      if: steps.external_selinux.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/selinux
    - name: Restore Cache external/sonic
      id: external_sonic
      uses: actions/cache@v3
      with:
        path: aosp/external/sonic
        key: external_sonic@${{ env.branch }}
        restore-keys: external_sonic@${{ env.branch }}
    - name: Clone project external/sonic
      if: steps.external_sonic.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/sonic
    - name: Restore Cache external/speex
      id: external_speex
      uses: actions/cache@v3
      with:
        path: aosp/external/speex
        key: external_speex@${{ env.branch }}
        restore-keys: external_speex@${{ env.branch }}
    - name: Clone project external/speex
      if: steps.external_speex.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/speex
    - name: Restore Cache external/starlark-go
      id: external_starlark-go
      uses: actions/cache@v3
      with:
        path: aosp/external/starlark-go
        key: external_starlark-go@${{ env.branch }}
        restore-keys: external_starlark-go@${{ env.branch }}
    - name: Clone project external/starlark-go
      if: steps.external_starlark-go.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/starlark-go
    - name: Restore Cache external/strace
      id: external_strace
      uses: actions/cache@v3
      with:
        path: aosp/external/strace
        key: external_strace@${{ env.branch }}
        restore-keys: external_strace@${{ env.branch }}
    - name: Clone project external/strace
      if: steps.external_strace.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/strace
    - name: Restore Cache external/swiftshader
      id: external_swiftshader
      uses: actions/cache@v3
      with:
        path: aosp/external/swiftshader
        key: external_swiftshader@${{ env.branch }}
        restore-keys: external_swiftshader@${{ env.branch }}
    - name: Clone project external/swiftshader
      if: steps.external_swiftshader.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/swiftshader
    - name: Restore Cache external/tinyalsa
      id: external_tinyalsa
      uses: actions/cache@v3
      with:
        path: aosp/external/tinyalsa
        key: external_tinyalsa@${{ env.branch }}
        restore-keys: external_tinyalsa@${{ env.branch }}
    - name: Clone project external/tinyalsa
      if: steps.external_tinyalsa.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/tinyalsa
    - name: Restore Cache external/vixl
      id: external_vixl
      uses: actions/cache@v3
      with:
        path: aosp/external/vixl
        key: external_vixl@${{ env.branch }}
        restore-keys: external_vixl@${{ env.branch }}
    - name: Clone project external/vixl
      if: steps.external_vixl.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/vixl
    - name: Restore Cache external/vm_tools/p9
      id: external_vm_tools_p9
      uses: actions/cache@v3
      with:
        path: aosp/external/vm_tools/p9
        key: external_vm_tools_p9@${{ env.branch }}
        restore-keys: external_vm_tools_p9@${{ env.branch }}
    - name: Clone project external/vm_tools/p9
      if: steps.external_vm_tools_p9.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/vm_tools/p9
    - name: Restore Cache external/wayland
      id: external_wayland
      uses: actions/cache@v3
      with:
        path: aosp/external/wayland
        key: external_wayland@${{ env.branch }}
        restore-keys: external_wayland@${{ env.branch }}
    - name: Clone project external/wayland
      if: steps.external_wayland.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/wayland
    - name: Restore Cache external/webp
      id: external_webp
      uses: actions/cache@v3
      with:
        path: aosp/external/webp
        key: external_webp@${{ env.branch }}
        restore-keys: external_webp@${{ env.branch }}
    - name: Clone project external/webp
      if: steps.external_webp.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/webp
    - name: Restore Cache external/xz-embedded
      id: external_xz-embedded
      uses: actions/cache@v3
      with:
        path: aosp/external/xz-embedded
        key: external_xz-embedded@${{ env.branch }}
        restore-keys: external_xz-embedded@${{ env.branch }}
    - name: Clone project external/xz-embedded
      if: steps.external_xz-embedded.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/xz-embedded
    - name: Restore Cache external/zopfli
      id: external_zopfli
      uses: actions/cache@v3
      with:
        path: aosp/external/zopfli
        key: external_zopfli@${{ env.branch }}
        restore-keys: external_zopfli@${{ env.branch }}
    - name: Clone project external/zopfli
      if: steps.external_zopfli.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/zopfli
    - name: Restore Cache external/zstd
      id: external_zstd
      uses: actions/cache@v3
      with:
        path: aosp/external/zstd
        key: external_zstd@${{ env.branch }}
        restore-keys: external_zstd@${{ env.branch }}
    - name: Clone project external/zstd
      if: steps.external_zstd.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/zstd
    - name: Restore Cache frameworks/av
      id: frameworks_av
      uses: actions/cache@v3
      with:
        path: aosp/frameworks/av
        key: frameworks_av@${{ env.branch }}
        restore-keys: frameworks_av@${{ env.branch }}
    - name: Clone project frameworks/av
      if: steps.frameworks_av.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform frameworks/av
    - name: Restore Cache frameworks/compile/libbcc
      id: frameworks_compile_libbcc
      uses: actions/cache@v3
      with:
        path: aosp/frameworks/compile/libbcc
        key: frameworks_compile_libbcc@${{ env.branch }}
        restore-keys: frameworks_compile_libbcc@${{ env.branch }}
    - name: Clone project frameworks/compile/libbcc
      if: steps.frameworks_compile_libbcc.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform frameworks/compile/libbcc
    - name: Restore Cache frameworks/native
      id: frameworks_native
      uses: actions/cache@v3
      with:
        path: aosp/frameworks/native
        key: frameworks_native@${{ env.branch }}
        restore-keys: frameworks_native@${{ env.branch }}
    - name: Clone project frameworks/native
      if: steps.frameworks_native.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform frameworks/native
    - name: Restore Cache frameworks/wilhelm
      id: frameworks_wilhelm
      uses: actions/cache@v3
      with:
        path: aosp/frameworks/wilhelm
        key: frameworks_wilhelm@${{ env.branch }}
        restore-keys: frameworks_wilhelm@${{ env.branch }}
    - name: Clone project frameworks/wilhelm
      if: steps.frameworks_wilhelm.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform frameworks/wilhelm
    - name: Restore Cache hardware/interfaces
      id: hardware_interfaces
      uses: actions/cache@v3
      with:
        path: aosp/hardware/interfaces
        key: hardware_interfaces@${{ env.branch }}
        restore-keys: hardware_interfaces@${{ env.branch }}
    - name: Clone project hardware/interfaces
      if: steps.hardware_interfaces.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform hardware/interfaces
    - name: Restore Cache hardware/libhardware
      id: hardware_libhardware
      uses: actions/cache@v3
      with:
        path: aosp/hardware/libhardware
        key: hardware_libhardware@${{ env.branch }}
        restore-keys: hardware_libhardware@${{ env.branch }}
    - name: Clone project hardware/libhardware
      if: steps.hardware_libhardware.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform hardware/libhardware
    - name: Restore Cache kernel/configs
      id: kernel_configs
      uses: actions/cache@v3
      with:
        path: aosp/kernel/configs
        key: kernel_configs@${{ env.branch }}
        restore-keys: kernel_configs@${{ env.branch }}
    - name: Clone project kernel/configs
      if: steps.kernel_configs.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth kernel/configs
    - name: Restore Cache libnativehelper
      id: libnativehelper
      uses: actions/cache@v3
      with:
        path: aosp/libnativehelper
        key: libnativehelper@${{ env.branch }}
        restore-keys: libnativehelper@${{ env.branch }}
    - name: Clone project libnativehelper
      if: steps.libnativehelper.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform libnativehelper
    - name: Restore Cache packages/inputmethods/LatinIME
      id: packages_inputmethods_LatinIME
      uses: actions/cache@v3
      with:
        path: aosp/packages/inputmethods/LatinIME
        key: packages_inputmethods_LatinIME@${{ env.branch }}
        restore-keys: packages_inputmethods_LatinIME@${{ env.branch }}
    - name: Clone project packages/inputmethods/LatinIME
      if: steps.packages_inputmethods_LatinIME.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform packages/inputmethods/LatinIME
    - name: Restore Cache packages/modules/DnsResolver
      id: packages_modules_DnsResolver
      uses: actions/cache@v3
      with:
        path: aosp/packages/modules/DnsResolver
        key: packages_modules_DnsResolver@${{ env.branch }}
        restore-keys: packages_modules_DnsResolver@${{ env.branch }}
    - name: Clone project packages/modules/DnsResolver
      if: steps.packages_modules_DnsResolver.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform packages/modules/DnsResolver
    - name: Restore Cache packages/modules/StatsD
      id: packages_modules_StatsD
      uses: actions/cache@v3
      with:
        path: aosp/packages/modules/StatsD
        key: packages_modules_StatsD@${{ env.branch }}
        restore-keys: packages_modules_StatsD@${{ env.branch }}
    - name: Clone project packages/modules/StatsD
      if: steps.packages_modules_StatsD.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform packages/modules/StatsD
    - name: Restore Cache packages/modules/common
      id: packages_modules_common
      uses: actions/cache@v3
      with:
        path: aosp/packages/modules/common
        key: packages_modules_common@${{ env.branch }}
        restore-keys: packages_modules_common@${{ env.branch }}
    - name: Clone project packages/modules/common
      if: steps.packages_modules_common.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform packages/modules/common
    - name: Restore Cache prebuilts/build-tools
      id: prebuilts_build-tools
      uses: actions/cache@v3
      with:
        path: aosp/prebuilts/build-tools
        key: prebuilts_build-tools@${{ env.branch }}
        restore-keys: prebuilts_build-tools@${{ env.branch }}
    - name: Clone project prebuilts/build-tools
      if: steps.prebuilts_build-tools.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse prebuilts/build-tools linux-x86/bin linux-x86/lib64 path common
    - name: Restore Cache prebuilts/clang-tools
      id: prebuilts_clang-tools
      uses: actions/cache@v3
      with:
        path: aosp/prebuilts/clang-tools
        key: prebuilts_clang-tools@${{ env.branch }}
        restore-keys: prebuilts_clang-tools@${{ env.branch }}
    - name: Clone project prebuilts/clang-tools
      if: steps.prebuilts_clang-tools.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse prebuilts/clang-tools linux-x86/bin linux-x86/lib64/clang
    - name: Restore Cache prebuilts/clang/host/linux-x86
      id: prebuilts_clang_host_linux-x86
      uses: actions/cache@v3
      with:
        path: aosp/prebuilts/clang/host/linux-x86
        key: prebuilts_clang_host_linux-x86@${{ env.branch }}
        restore-keys: prebuilts_clang_host_linux-x86@${{ env.branch }}
    - name: Clone project prebuilts/clang/host/linux-x86
      if: steps.prebuilts_clang_host_linux-x86.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse prebuilts/clang/host/linux-x86 $(python ${GITHUB_WORKSPACE}/get_clang_version.py) soong
    - name: Restore Cache prebuilts/gcc/linux-x86/host/x86_64-linux-glibc2.17-4.8
      id: prebuilts_gcc_linux-x86_host_x86_64-linux-glibc2_17-4_8
      uses: actions/cache@v3
      with:
        path: aosp/prebuilts/gcc/linux-x86/host/x86_64-linux-glibc2.17-4.8
        key: prebuilts_gcc_linux-x86_host_x86_64-linux-glibc2_17-4_8@${{ env.branch }}
        restore-keys: prebuilts_gcc_linux-x86_host_x86_64-linux-glibc2_17-4_8@${{ env.branch }}
    - name: Clone project prebuilts/gcc/linux-x86/host/x86_64-linux-glibc2.17-4.8
      if: steps.prebuilts_gcc_linux-x86_host_x86_64-linux-glibc2_17-4_8.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse prebuilts/gcc/linux-x86/host/x86_64-linux-glibc2.17-4.8 sysroot lib/gcc/x86_64-linux/4.8.3 x86_64-linux/lib64 x86_64-linux/lib32
    - name: Restore Cache prebuilts/jdk/jdk11
      id: prebuilts_jdk_jdk11
      uses: actions/cache@v3
      with:
        path: aosp/prebuilts/jdk/jdk11
        key: prebuilts_jdk_jdk11@${{ env.branch }}
        restore-keys: prebuilts_jdk_jdk11@${{ env.branch }}
    - name: Clone project prebuilts/jdk/jdk11
      if: steps.prebuilts_jdk_jdk11.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse prebuilts/jdk/jdk11 linux-x86
    - name: Restore Cache prebuilts/jdk/jdk8
      id: prebuilts_jdk_jdk8
      uses: actions/cache@v3
      with:
        path: aosp/prebuilts/jdk/jdk8
        key: prebuilts_jdk_jdk8@${{ env.branch }}
        restore-keys: prebuilts_jdk_jdk8@${{ env.branch }}
    - name: Clone project prebuilts/jdk/jdk8
      if: steps.prebuilts_jdk_jdk8.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse prebuilts/jdk/jdk8 linux-x86
    - name: Restore Cache prebuilts/misc
      id: prebuilts_misc
      uses: actions/cache@v3
      with:
        path: aosp/prebuilts/misc
        key: prebuilts_misc@${{ env.branch }}
        restore-keys: prebuilts_misc@${{ env.branch }}
    - name: Clone project prebuilts/misc
      if: steps.prebuilts_misc.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse_exclude prebuilts/misc "!/common/robolectric" "!/darwin-x86" "!/darwin-x86_64" "!/gdbserver"
    - name: Restore Cache prebuilts/ndk
      id: prebuilts_ndk
      uses: actions/cache@v3
      with:
        path: aosp/prebuilts/ndk
        key: prebuilts_ndk@${{ env.branch }}
        restore-keys: prebuilts_ndk@${{ env.branch }}
    - name: Clone project prebuilts/ndk
      if: steps.prebuilts_ndk.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse prebuilts/ndk current
    - name: Restore Cache prebuilts/rust
      id: prebuilts_rust
      uses: actions/cache@v3
      with:
        path: aosp/prebuilts/rust
        key: prebuilts_rust@${{ env.branch }}
        restore-keys: prebuilts_rust@${{ env.branch }}
    - name: Clone project prebuilts/rust
      if: steps.prebuilts_rust.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse prebuilts/rust bootstrap linux-x86/1.51.0
    - name: Restore Cache system/bpf
      id: system_bpf
      uses: actions/cache@v3
      with:
        path: aosp/system/bpf
        key: system_bpf@${{ env.branch }}
        restore-keys: system_bpf@${{ env.branch }}
    - name: Clone project system/bpf
      if: steps.system_bpf.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/bpf
    - name: Restore Cache system/bt
      id: system_bt
      uses: actions/cache@v3
      with:
        path: aosp/system/bt
        key: system_bt@${{ env.branch }}
        restore-keys: system_bt@${{ env.branch }}
    - name: Clone project system/bt
      if: steps.system_bt.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/bt
    - name: Restore Cache system/core
      id: system_core
      uses: actions/cache@v3
      with:
        path: aosp/system/core
        key: system_core@${{ env.branch }}
        restore-keys: system_core@${{ env.branch }}
    - name: Clone project system/core
      if: steps.system_core.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/core
    - name: Restore Cache system/extras
      id: system_extras
      uses: actions/cache@v3
      with:
        path: aosp/system/extras
        key: system_extras@${{ env.branch }}
        restore-keys: system_extras@${{ env.branch }}
    - name: Clone project system/extras
      if: steps.system_extras.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse_exclude system/extras "!/simpleperf/scripts" "!/simpleperf/testdata" "!/simpleperf/demo" "!/simpleperf/doc" "!/memory_replay/traces" "!/ioshark/*.tgz" "!/ioshark/*.tar.gz"
    - name: Restore Cache system/gatekeeper
      id: system_gatekeeper
      uses: actions/cache@v3
      with:
        path: aosp/system/gatekeeper
        key: system_gatekeeper@${{ env.branch }}
        restore-keys: system_gatekeeper@${{ env.branch }}
    - name: Clone project system/gatekeeper
      if: steps.system_gatekeeper.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/gatekeeper
    - name: Restore Cache system/gsid
      id: system_gsid
      uses: actions/cache@v3
      with:
        path: aosp/system/gsid
        key: system_gsid@${{ env.branch }}
        restore-keys: system_gsid@${{ env.branch }}
    - name: Clone project system/gsid
      if: steps.system_gsid.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/gsid
    - name: Restore Cache system/keymaster
      id: system_keymaster
      uses: actions/cache@v3
      with:
        path: aosp/system/keymaster
        key: system_keymaster@${{ env.branch }}
        restore-keys: system_keymaster@${{ env.branch }}
    - name: Clone project system/keymaster
      if: steps.system_keymaster.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/keymaster
    - name: Restore Cache system/libbase
      id: system_libbase
      uses: actions/cache@v3
      with:
        path: aosp/system/libbase
        key: system_libbase@${{ env.branch }}
        restore-keys: system_libbase@${{ env.branch }}
    - name: Clone project system/libbase
      if: steps.system_libbase.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/libbase
    - name: Restore Cache system/libhidl
      id: system_libhidl
      uses: actions/cache@v3
      with:
        path: aosp/system/libhidl
        key: system_libhidl@${{ env.branch }}
        restore-keys: system_libhidl@${{ env.branch }}
    - name: Clone project system/libhidl
      if: steps.system_libhidl.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/libhidl
    - name: Restore Cache system/libhwbinder
      id: system_libhwbinder
      uses: actions/cache@v3
      with:
        path: aosp/system/libhwbinder
        key: system_libhwbinder@${{ env.branch }}
        restore-keys: system_libhwbinder@${{ env.branch }}
    - name: Clone project system/libhwbinder
      if: steps.system_libhwbinder.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/libhwbinder
    - name: Restore Cache system/logging
      id: system_logging
      uses: actions/cache@v3
      with:
        path: aosp/system/logging
        key: system_logging@${{ env.branch }}
        restore-keys: system_logging@${{ env.branch }}
    - name: Clone project system/logging
      if: steps.system_logging.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/logging
    - name: Restore Cache system/media
      id: system_media
      uses: actions/cache@v3
      with:
        path: aosp/system/media
        key: system_media@${{ env.branch }}
        restore-keys: system_media@${{ env.branch }}
    - name: Clone project system/media
      if: steps.system_media.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/media
    - name: Restore Cache system/netd
      id: system_netd
      uses: actions/cache@v3
      with:
        path: aosp/system/netd
        key: system_netd@${{ env.branch }}
        restore-keys: system_netd@${{ env.branch }}
    - name: Clone project system/netd
      if: steps.system_netd.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/netd
    - name: Restore Cache system/sepolicy
      id: system_sepolicy
      uses: actions/cache@v3
      with:
        path: aosp/system/sepolicy
        key: system_sepolicy@${{ env.branch }}
        restore-keys: system_sepolicy@${{ env.branch }}
    - name: Clone project system/sepolicy
      if: steps.system_sepolicy.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/sepolicy
    - name: Restore Cache system/tools/aidl
      id: system_tools_aidl
      uses: actions/cache@v3
      with:
        path: aosp/system/tools/aidl
        key: system_tools_aidl@${{ env.branch }}
        restore-keys: system_tools_aidl@${{ env.branch }}
    - name: Clone project system/tools/aidl
      if: steps.system_tools_aidl.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/tools/aidl
    - name: Restore Cache system/tools/hidl
      id: system_tools_hidl
      uses: actions/cache@v3
      with:
        path: aosp/system/tools/hidl
        key: system_tools_hidl@${{ env.branch }}
        restore-keys: system_tools_hidl@${{ env.branch }}
    - name: Clone project system/tools/hidl
      if: steps.system_tools_hidl.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/tools/hidl
    - name: Restore Cache system/tools/mkbootimg
      id: system_tools_mkbootimg
      uses: actions/cache@v3
      with:
        path: aosp/system/tools/mkbootimg
        key: system_tools_mkbootimg@${{ env.branch }}
        restore-keys: system_tools_mkbootimg@${{ env.branch }}
    - name: Clone project system/tools/mkbootimg
      if: steps.system_tools_mkbootimg.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/tools/mkbootimg
    - name: Restore Cache tools/dexter
      id: tools_dexter
      uses: actions/cache@v3
      with:
        path: aosp/tools/dexter
        key: tools_dexter@${{ env.branch }}
        restore-keys: tools_dexter@${{ env.branch }}
    - name: Clone project tools/dexter
      if: steps.tools_dexter.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse_exclude tools/dexter !/testdata
    - name: Restore Cache tools/security
      id: tools_security
      uses: actions/cache@v3
      with:
        path: aosp/tools/security
        key: tools_security@${{ env.branch }}
        restore-keys: tools_security@${{ env.branch }}
    - name: Clone project tools/security
      if: steps.tools_security.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform tools/security

    - name: Download Release
      run: |
        source $GITHUB_WORKSPACE/envsetup.sh
        download_release bionic-1 bionic/ android-12.0.0_r1-1
        download_release external_arm-optimized-routines-0 external/arm-optimized-routines/ android-12.0.0_r1-0
        download_release external_bc-2 external/bc/ android-12.0.0_r1-2
        download_release external_brotli-2 external/brotli/ android-12.0.0_r1-2
        download_release external_bzip2-2 external/bzip2/ android-12.0.0_r1-2
        download_release external_crosvm-0 external/crosvm/ android-12.0.0_r1-0
        download_release external_expat-2 external/expat/ android-12.0.0_r1-2
        download_release external_gwp_asan-0 external/gwp_asan/ android-12.0.0_r1-0
        download_release external_libcxx-3 external/libcxx/ android-12.0.0_r1-3
        download_release external_libcxxabi-2 external/libcxxabi/ android-12.0.0_r1-2
        download_release external_lzma-2 external/lzma/ android-12.0.0_r1-2
        download_release external_mksh-2 external/mksh/ android-12.0.0_r1-2
        download_release external_one-true-awk-2 external/one-true-awk/ android-12.0.0_r1-2
        download_release external_pcre-2 external/pcre/ android-12.0.0_r1-2
        download_release external_rust_crates_bytes-0 external/rust/crates/bytes/ android-12.0.0_r1-0
        download_release external_rust_crates_codespan-reporting-1 external/rust/crates/codespan-reporting/ android-12.0.0_r1-1
        download_release external_rust_crates_downcast-rs-0 external/rust/crates/downcast-rs/ android-12.0.0_r1-0
        download_release external_rust_crates_either-0 external/rust/crates/either/ android-12.0.0_r1-0
        download_release external_rust_crates_fallible-iterator-0 external/rust/crates/fallible-iterator/ android-12.0.0_r1-0
        download_release external_rust_crates_fallible-streaming-iterator-0 external/rust/crates/fallible-streaming-iterator/ android-12.0.0_r1-0
        download_release external_rust_crates_glob-0 external/rust/crates/glob/ android-12.0.0_r1-0
        download_release external_rust_crates_grpcio-compiler-2 external/rust/crates/grpcio-compiler/ android-12.0.0_r1-2
        download_release external_rust_crates_heck-1 external/rust/crates/heck/ android-12.0.0_r1-1
        download_release external_rust_crates_lazycell-0 external/rust/crates/lazycell/ android-12.0.0_r1-0
        download_release external_rust_crates_lock_api-1 external/rust/crates/lock_api/ android-12.0.0_r1-1
        download_release external_rust_crates_paste-0 external/rust/crates/paste/ android-12.0.0_r1-0
        download_release external_rust_crates_peeking_take_while-0 external/rust/crates/peeking_take_while/ android-12.0.0_r1-0
        download_release external_rust_crates_proc-macro-error-attr-3 external/rust/crates/proc-macro-error-attr/ android-12.0.0_r1-3
        download_release external_rust_crates_proc-macro-hack-0 external/rust/crates/proc-macro-hack/ android-12.0.0_r1-0
        download_release external_rust_crates_proc-macro2-1 external/rust/crates/proc-macro2/ android-12.0.0_r1-1
        download_release external_rust_crates_protobuf-codegen-2 external/rust/crates/protobuf-codegen/ android-12.0.0_r1-2
        download_release external_rust_crates_protobuf-1 external/rust/crates/protobuf/ android-12.0.0_r1-1
        download_release external_rust_crates_quote-2 external/rust/crates/quote/ android-12.0.0_r1-2
        download_release external_rust_crates_regex-syntax-0 external/rust/crates/regex-syntax/ android-12.0.0_r1-0
        download_release external_rust_crates_rustc-hash-0 external/rust/crates/rustc-hash/ android-12.0.0_r1-0
        download_release external_rust_crates_scopeguard-0 external/rust/crates/scopeguard/ android-12.0.0_r1-0
        download_release external_rust_crates_shlex-0 external/rust/crates/shlex/ android-12.0.0_r1-0
        download_release external_rust_crates_syn-3 external/rust/crates/syn/ android-12.0.0_r1-3
        download_release external_rust_crates_termcolor-0 external/rust/crates/termcolor/ android-12.0.0_r1-0
        download_release external_rust_crates_unicode-segmentation-0 external/rust/crates/unicode-segmentation/ android-12.0.0_r1-0
        download_release external_rust_crates_unicode-width-0 external/rust/crates/unicode-width/ android-12.0.0_r1-0
        download_release external_rust_crates_unicode-xid-0 external/rust/crates/unicode-xid/ android-12.0.0_r1-0
        download_release external_scudo-0 external/scudo/ android-12.0.0_r1-0
        download_release external_selinux-2 external/selinux/ android-12.0.0_r1-2
        download_release external_zlib-2 external/zlib/ android-12.0.0_r1-2
        download_release frameworks_rs-2 frameworks/rs/ android-12.0.0_r1-2
        download_release system_bt-0 system/bt/ android-12.0.0_r1-0
        download_release system_core-2 system/core/ android-12.0.0_r1-2
        download_release system_sepolicy-3 system/sepolicy/ android-12.0.0_r1-3
    - name: Start Soong
      run: |
        pushd aosp
        export TOP=$(pwd)
        cp build/make/core/root.mk Makefile
        ln -sf make/CleanSpec.mk build/ && ln -sf make/core build/
        ln -sf make/target build/ && ln -sf make/tools build/
        ln -sf build/soong/root.bp Android.bp
        mkdir -p prebuilts/go && touch prebuilts/go/.out-dir
        ln -sf $GOROOT_1_19_X64 prebuilts/go/linux-x86
        mkdir -p out/soong/.minibootstrap out/soong/.bootstrap/bin
        ln -sf $GITHUB_WORKSPACE/soong_build out/soong/.bootstrap/bin
        ln -sf $GITHUB_WORKSPACE/bpglob out/soong/.minibootstrap
        cp $GITHUB_WORKSPACE/ckati prebuilts/build-tools/linux-x86/bin
        mkdir -p prebuiltlibs && cp $GITHUB_WORKSPACE/Android.bp prebuiltlibs/
        mkdir -p prebuiltlibs && cp $GITHUB_WORKSPACE/rust_prebuilt.list prebuiltlibs/
        GOROOT=$TOP/prebuilts/go/linux-x86 $GITHUB_WORKSPACE/soong_ui --make-mode --skip-ninja --skip-kati --skip-soong-tests --skip-write-modules -j1 TARGET_PRODUCT=aosp_x86_64 TARGET_BUILD_VARIANT=eng ALLOW_MISSING_DEPENDENCIES=true BUILD_BROKEN_DISABLE_BAZEL=1 nothing
        $GITHUB_WORKSPACE/build.sh
        du -ah -d1 out/soong |sort -h
        du -ah -d1 . |sort -h

    - name: Archive external_bcc-4.tar.xz
      uses: actions/upload-artifact@v3
      with:
        name: external_bcc-4.tar.xz
        path: aosp/external_bcc-4.tar.xz

    - uses: softprops/action-gh-release@master
      with:
        name: ${{ env.branch }}-4
        tag_name: ${{ env.branch }}-4
        files: |
          aosp/external_bcc-4.tar.xz
