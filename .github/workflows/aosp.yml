
name: AOSP Build
on:
  push:
    branches:
    - main
env:
  branch: 'android-12.0.0_r1'
jobs:
  build_step11:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@main
    - uses: actions/setup-python@v4
      with:
        python-version: "2.7"
    - name: Download get_clang_version.py
      run: |
        curl "https://android.googlesource.com/platform/build/soong/+/refs/heads/master/scripts/get_clang_version.py?format=TEXT" | base64 -d > $GITHUB_WORKSPACE/get_clang_version.py
        mkdir -p aosp

    - name: Restore Cache build/make
      id: build_make
      uses: actions/cache@v3
      with:
        path: aosp/build/make
        key: build_make@${{ env.branch }}
        restore-keys: build_make@${{ env.branch }}
    - name: Clone project build/make
      if: steps.build_make.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform build
        mv build make && mkdir build && mv make build/
        sed -i 's/^PRODUCT_EXTRA_VNDK_VERSIONS/#PRODUCT_EXTRA_VNDK_VERSIONS/g' build/make/target/product/gsi_release.mk
    - name: Restore Cache bionic
      id: bionic
      uses: actions/cache@v3
      with:
        path: aosp/bionic
        key: bionic@${{ env.branch }}
        restore-keys: bionic@${{ env.branch }}
    - name: Clone project bionic
      if: steps.bionic.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform bionic
    - name: Restore Cache bootable/recovery
      id: bootable_recovery
      uses: actions/cache@v3
      with:
        path: aosp/bootable/recovery
        key: bootable_recovery@${{ env.branch }}
        restore-keys: bootable_recovery@${{ env.branch }}
    - name: Clone project bootable/recovery
      if: steps.bootable_recovery.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform bootable/recovery
    - name: Restore Cache build/blueprint
      id: build_blueprint
      uses: actions/cache@v3
      with:
        path: aosp/build/blueprint
        key: build_blueprint@${{ env.branch }}
        restore-keys: build_blueprint@${{ env.branch }}
    - name: Clone project build/blueprint
      if: steps.build_blueprint.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform build/blueprint
    - name: Restore Cache build/soong
      id: build_soong
      uses: actions/cache@v3
      with:
        path: aosp/build/soong
        key: build_soong@${{ env.branch }}
        restore-keys: build_soong@${{ env.branch }}
    - name: Clone project build/soong
      if: steps.build_soong.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform build/soong
    - name: Restore Cache device/generic/vulkan-cereal
      id: device_generic_vulkan-cereal
      uses: actions/cache@v3
      with:
        path: aosp/device/generic/vulkan-cereal
        key: device_generic_vulkan-cereal@${{ env.branch }}
        restore-keys: device_generic_vulkan-cereal@${{ env.branch }}
    - name: Clone project device/generic/vulkan-cereal
      if: steps.device_generic_vulkan-cereal.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth device/generic/vulkan-cereal
    - name: Restore Cache device/google/cuttlefish
      id: device_google_cuttlefish
      uses: actions/cache@v3
      with:
        path: aosp/device/google/cuttlefish
        key: device_google_cuttlefish@${{ env.branch }}
        restore-keys: device_google_cuttlefish@${{ env.branch }}
    - name: Clone project device/google/cuttlefish
      if: steps.device_google_cuttlefish.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth device/google/cuttlefish
    - name: Restore Cache external/aac
      id: external_aac
      uses: actions/cache@v3
      with:
        path: aosp/external/aac
        key: external_aac@${{ env.branch }}
        restore-keys: external_aac@${{ env.branch }}
    - name: Clone project external/aac
      if: steps.external_aac.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/aac
    - name: Restore Cache external/angle
      id: external_angle
      uses: actions/cache@v3
      with:
        path: aosp/external/angle
        key: external_angle@${{ env.branch }}
        restore-keys: external_angle@${{ env.branch }}
    - name: Clone project external/angle
      if: steps.external_angle.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/angle
    - name: Restore Cache external/compiler-rt
      id: external_compiler-rt
      uses: actions/cache@v3
      with:
        path: aosp/external/compiler-rt
        key: external_compiler-rt@${{ env.branch }}
        restore-keys: external_compiler-rt@${{ env.branch }}
    - name: Clone project external/compiler-rt
      if: steps.external_compiler-rt.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/compiler-rt
    - name: Restore Cache external/cros/system_api
      id: external_cros_system_api
      uses: actions/cache@v3
      with:
        path: aosp/external/cros/system_api
        key: external_cros_system_api@${{ env.branch }}
        restore-keys: external_cros_system_api@${{ env.branch }}
    - name: Clone project external/cros/system_api
      if: steps.external_cros_system_api.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/cros/system_api
    - name: Restore Cache external/crosvm
      id: external_crosvm
      uses: actions/cache@v3
      with:
        path: aosp/external/crosvm
        key: external_crosvm@${{ env.branch }}
        restore-keys: external_crosvm@${{ env.branch }}
    - name: Clone project external/crosvm
      if: steps.external_crosvm.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/crosvm
    - name: Restore Cache external/drm_hwcomposer
      id: external_drm_hwcomposer
      uses: actions/cache@v3
      with:
        path: aosp/external/drm_hwcomposer
        key: external_drm_hwcomposer@${{ env.branch }}
        restore-keys: external_drm_hwcomposer@${{ env.branch }}
    - name: Clone project external/drm_hwcomposer
      if: steps.external_drm_hwcomposer.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/drm_hwcomposer
    - name: Restore Cache external/golang-protobuf
      id: external_golang-protobuf
      uses: actions/cache@v3
      with:
        path: aosp/external/golang-protobuf
        key: external_golang-protobuf@${{ env.branch }}
        restore-keys: external_golang-protobuf@${{ env.branch }}
    - name: Clone project external/golang-protobuf
      if: steps.external_golang-protobuf.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/golang-protobuf
    - name: Restore Cache external/libavc
      id: external_libavc
      uses: actions/cache@v3
      with:
        path: aosp/external/libavc
        key: external_libavc@${{ env.branch }}
        restore-keys: external_libavc@${{ env.branch }}
    - name: Clone project external/libavc
      if: steps.external_libavc.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/libavc
    - name: Restore Cache external/libchrome
      id: external_libchrome
      uses: actions/cache@v3
      with:
        path: aosp/external/libchrome
        key: external_libchrome@${{ env.branch }}
        restore-keys: external_libchrome@${{ env.branch }}
    - name: Clone project external/libchrome
      if: steps.external_libchrome.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/libchrome
    - name: Restore Cache external/libldac
      id: external_libldac
      uses: actions/cache@v3
      with:
        path: aosp/external/libldac
        key: external_libldac@${{ env.branch }}
        restore-keys: external_libldac@${{ env.branch }}
    - name: Clone project external/libldac
      if: steps.external_libldac.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/libldac
    - name: Restore Cache external/libmpeg2
      id: external_libmpeg2
      uses: actions/cache@v3
      with:
        path: aosp/external/libmpeg2
        key: external_libmpeg2@${{ env.branch }}
        restore-keys: external_libmpeg2@${{ env.branch }}
    - name: Clone project external/libmpeg2
      if: steps.external_libmpeg2.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/libmpeg2
    - name: Restore Cache external/mdnsresponder
      id: external_mdnsresponder
      uses: actions/cache@v3
      with:
        path: aosp/external/mdnsresponder
        key: external_mdnsresponder@${{ env.branch }}
        restore-keys: external_mdnsresponder@${{ env.branch }}
    - name: Clone project external/mdnsresponder
      if: steps.external_mdnsresponder.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/mdnsresponder
    - name: Restore Cache external/minigbm
      id: external_minigbm
      uses: actions/cache@v3
      with:
        path: aosp/external/minigbm
        key: external_minigbm@${{ env.branch }}
        restore-keys: external_minigbm@${{ env.branch }}
    - name: Clone project external/minigbm
      if: steps.external_minigbm.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/minigbm
    - name: Restore Cache external/perfetto
      id: external_perfetto
      uses: actions/cache@v3
      with:
        path: aosp/external/perfetto
        key: external_perfetto@${{ env.branch }}
        restore-keys: external_perfetto@${{ env.branch }}
    - name: Clone project external/perfetto
      if: steps.external_perfetto.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/perfetto
    - name: Restore Cache external/protobuf
      id: external_protobuf
      uses: actions/cache@v3
      with:
        path: aosp/external/protobuf
        key: external_protobuf@${{ env.branch }}
        restore-keys: external_protobuf@${{ env.branch }}
    - name: Clone project external/protobuf
      if: steps.external_protobuf.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/protobuf
    - name: Restore Cache external/python/cpython2
      id: external_python_cpython2
      uses: actions/cache@v3
      with:
        path: aosp/external/python/cpython2
        key: external_python_cpython2@${{ env.branch }}
        restore-keys: external_python_cpython2@${{ env.branch }}
    - name: Clone project external/python/cpython2
      if: steps.external_python_cpython2.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/python/cpython2
    - name: Restore Cache external/rust/cxx
      id: external_rust_cxx
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/cxx
        key: external_rust_cxx@${{ env.branch }}
        restore-keys: external_rust_cxx@${{ env.branch }}
    - name: Clone project external/rust/cxx
      if: steps.external_rust_cxx.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/cxx
    - name: Restore Cache external/skia
      id: external_skia
      uses: actions/cache@v3
      with:
        path: aosp/external/skia
        key: external_skia@${{ env.branch }}
        restore-keys: external_skia@${{ env.branch }}
    - name: Clone project external/skia
      if: steps.external_skia.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/skia
    - name: Restore Cache external/sonic
      id: external_sonic
      uses: actions/cache@v3
      with:
        path: aosp/external/sonic
        key: external_sonic@${{ env.branch }}
        restore-keys: external_sonic@${{ env.branch }}
    - name: Clone project external/sonic
      if: steps.external_sonic.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/sonic
    - name: Restore Cache external/starlark-go
      id: external_starlark-go
      uses: actions/cache@v3
      with:
        path: aosp/external/starlark-go
        key: external_starlark-go@${{ env.branch }}
        restore-keys: external_starlark-go@${{ env.branch }}
    - name: Clone project external/starlark-go
      if: steps.external_starlark-go.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/starlark-go
    - name: Restore Cache external/swiftshader
      id: external_swiftshader
      uses: actions/cache@v3
      with:
        path: aosp/external/swiftshader
        key: external_swiftshader@${{ env.branch }}
        restore-keys: external_swiftshader@${{ env.branch }}
    - name: Clone project external/swiftshader
      if: steps.external_swiftshader.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/swiftshader
    - name: Restore Cache external/vm_tools/p9
      id: external_vm_tools_p9
      uses: actions/cache@v3
      with:
        path: aosp/external/vm_tools/p9
        key: external_vm_tools_p9@${{ env.branch }}
        restore-keys: external_vm_tools_p9@${{ env.branch }}
    - name: Clone project external/vm_tools/p9
      if: steps.external_vm_tools_p9.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/vm_tools/p9
    - name: Restore Cache frameworks/av
      id: frameworks_av
      uses: actions/cache@v3
      with:
        path: aosp/frameworks/av
        key: frameworks_av@${{ env.branch }}
        restore-keys: frameworks_av@${{ env.branch }}
    - name: Clone project frameworks/av
      if: steps.frameworks_av.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform frameworks/av
    - name: Restore Cache frameworks/base
      id: frameworks_base
      uses: actions/cache@v3
      with:
        path: aosp/frameworks/base
        key: frameworks_base@${{ env.branch }}
        restore-keys: frameworks_base@${{ env.branch }}
    - name: Clone project frameworks/base
      if: steps.frameworks_base.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse_exclude frameworks/base "!/data/videos" "!/media/tests/contents" "!/docs" "!/native/graphics/jni/fuzz" "!/cmd/incidentd/testdata"
    - name: Restore Cache frameworks/hardware/interfaces
      id: frameworks_hardware_interfaces
      uses: actions/cache@v3
      with:
        path: aosp/frameworks/hardware/interfaces
        key: frameworks_hardware_interfaces@${{ env.branch }}
        restore-keys: frameworks_hardware_interfaces@${{ env.branch }}
    - name: Clone project frameworks/hardware/interfaces
      if: steps.frameworks_hardware_interfaces.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform frameworks/hardware/interfaces
    - name: Restore Cache frameworks/native
      id: frameworks_native
      uses: actions/cache@v3
      with:
        path: aosp/frameworks/native
        key: frameworks_native@${{ env.branch }}
        restore-keys: frameworks_native@${{ env.branch }}
    - name: Clone project frameworks/native
      if: steps.frameworks_native.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform frameworks/native
    - name: Restore Cache frameworks/proto_logging
      id: frameworks_proto_logging
      uses: actions/cache@v3
      with:
        path: aosp/frameworks/proto_logging
        key: frameworks_proto_logging@${{ env.branch }}
        restore-keys: frameworks_proto_logging@${{ env.branch }}
    - name: Clone project frameworks/proto_logging
      if: steps.frameworks_proto_logging.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform frameworks/proto_logging
    - name: Restore Cache frameworks/rs
      id: frameworks_rs
      uses: actions/cache@v3
      with:
        path: aosp/frameworks/rs
        key: frameworks_rs@${{ env.branch }}
        restore-keys: frameworks_rs@${{ env.branch }}
    - name: Clone project frameworks/rs
      if: steps.frameworks_rs.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform frameworks/rs
    - name: Restore Cache hardware/google/camera
      id: hardware_google_camera
      uses: actions/cache@v3
      with:
        path: aosp/hardware/google/camera
        key: hardware_google_camera@${{ env.branch }}
        restore-keys: hardware_google_camera@${{ env.branch }}
    - name: Clone project hardware/google/camera
      if: steps.hardware_google_camera.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform hardware/google/camera
    - name: Restore Cache hardware/interfaces
      id: hardware_interfaces
      uses: actions/cache@v3
      with:
        path: aosp/hardware/interfaces
        key: hardware_interfaces@${{ env.branch }}
        restore-keys: hardware_interfaces@${{ env.branch }}
    - name: Clone project hardware/interfaces
      if: steps.hardware_interfaces.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform hardware/interfaces
    - name: Restore Cache kernel/configs
      id: kernel_configs
      uses: actions/cache@v3
      with:
        path: aosp/kernel/configs
        key: kernel_configs@${{ env.branch }}
        restore-keys: kernel_configs@${{ env.branch }}
    - name: Clone project kernel/configs
      if: steps.kernel_configs.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth kernel/configs
    - name: Restore Cache packages/apps/Gallery2
      id: packages_apps_Gallery2
      uses: actions/cache@v3
      with:
        path: aosp/packages/apps/Gallery2
        key: packages_apps_Gallery2@${{ env.branch }}
        restore-keys: packages_apps_Gallery2@${{ env.branch }}
    - name: Clone project packages/apps/Gallery2
      if: steps.packages_apps_Gallery2.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform packages/apps/Gallery2
    - name: Restore Cache packages/modules/Gki
      id: packages_modules_Gki
      uses: actions/cache@v3
      with:
        path: aosp/packages/modules/Gki
        key: packages_modules_Gki@${{ env.branch }}
        restore-keys: packages_modules_Gki@${{ env.branch }}
    - name: Clone project packages/modules/Gki
      if: steps.packages_modules_Gki.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform packages/modules/Gki
    - name: Restore Cache packages/modules/NeuralNetworks
      id: packages_modules_NeuralNetworks
      uses: actions/cache@v3
      with:
        path: aosp/packages/modules/NeuralNetworks
        key: packages_modules_NeuralNetworks@${{ env.branch }}
        restore-keys: packages_modules_NeuralNetworks@${{ env.branch }}
    - name: Clone project packages/modules/NeuralNetworks
      if: steps.packages_modules_NeuralNetworks.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform packages/modules/NeuralNetworks
    - name: Restore Cache packages/modules/Virtualization
      id: packages_modules_Virtualization
      uses: actions/cache@v3
      with:
        path: aosp/packages/modules/Virtualization
        key: packages_modules_Virtualization@${{ env.branch }}
        restore-keys: packages_modules_Virtualization@${{ env.branch }}
    - name: Clone project packages/modules/Virtualization
      if: steps.packages_modules_Virtualization.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform packages/modules/Virtualization
    - name: Restore Cache prebuilts/build-tools
      id: prebuilts_build-tools
      uses: actions/cache@v3
      with:
        path: aosp/prebuilts/build-tools
        key: prebuilts_build-tools@${{ env.branch }}
        restore-keys: prebuilts_build-tools@${{ env.branch }}
    - name: Clone project prebuilts/build-tools
      if: steps.prebuilts_build-tools.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse prebuilts/build-tools linux-x86/bin linux-x86/lib64 path common
    - name: Restore Cache prebuilts/clang-tools
      id: prebuilts_clang-tools
      uses: actions/cache@v3
      with:
        path: aosp/prebuilts/clang-tools
        key: prebuilts_clang-tools@${{ env.branch }}
        restore-keys: prebuilts_clang-tools@${{ env.branch }}
    - name: Clone project prebuilts/clang-tools
      if: steps.prebuilts_clang-tools.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse prebuilts/clang-tools linux-x86/bin linux-x86/lib64/clang
    - name: Restore Cache prebuilts/clang/host/linux-x86
      id: prebuilts_clang_host_linux-x86
      uses: actions/cache@v3
      with:
        path: aosp/prebuilts/clang/host/linux-x86
        key: prebuilts_clang_host_linux-x86@${{ env.branch }}
        restore-keys: prebuilts_clang_host_linux-x86@${{ env.branch }}
    - name: Clone project prebuilts/clang/host/linux-x86
      if: steps.prebuilts_clang_host_linux-x86.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse prebuilts/clang/host/linux-x86 $(python ${GITHUB_WORKSPACE}/get_clang_version.py) clang-r416183b soong
    - name: Restore Cache prebuilts/gcc/linux-x86/host/x86_64-linux-glibc2.17-4.8
      id: prebuilts_gcc_linux-x86_host_x86_64-linux-glibc2_17-4_8
      uses: actions/cache@v3
      with:
        path: aosp/prebuilts/gcc/linux-x86/host/x86_64-linux-glibc2.17-4.8
        key: prebuilts_gcc_linux-x86_host_x86_64-linux-glibc2_17-4_8@${{ env.branch }}
        restore-keys: prebuilts_gcc_linux-x86_host_x86_64-linux-glibc2_17-4_8@${{ env.branch }}
    - name: Clone project prebuilts/gcc/linux-x86/host/x86_64-linux-glibc2.17-4.8
      if: steps.prebuilts_gcc_linux-x86_host_x86_64-linux-glibc2_17-4_8.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse prebuilts/gcc/linux-x86/host/x86_64-linux-glibc2.17-4.8 sysroot lib/gcc/x86_64-linux/4.8.3 x86_64-linux/lib64 x86_64-linux/lib32
    - name: Restore Cache prebuilts/jdk/jdk11
      id: prebuilts_jdk_jdk11
      uses: actions/cache@v3
      with:
        path: aosp/prebuilts/jdk/jdk11
        key: prebuilts_jdk_jdk11@${{ env.branch }}
        restore-keys: prebuilts_jdk_jdk11@${{ env.branch }}
    - name: Clone project prebuilts/jdk/jdk11
      if: steps.prebuilts_jdk_jdk11.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse prebuilts/jdk/jdk11 linux-x86
    - name: Restore Cache prebuilts/jdk/jdk8
      id: prebuilts_jdk_jdk8
      uses: actions/cache@v3
      with:
        path: aosp/prebuilts/jdk/jdk8
        key: prebuilts_jdk_jdk8@${{ env.branch }}
        restore-keys: prebuilts_jdk_jdk8@${{ env.branch }}
    - name: Clone project prebuilts/jdk/jdk8
      if: steps.prebuilts_jdk_jdk8.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse prebuilts/jdk/jdk8 linux-x86
    - name: Restore Cache prebuilts/misc
      id: prebuilts_misc
      uses: actions/cache@v3
      with:
        path: aosp/prebuilts/misc
        key: prebuilts_misc@${{ env.branch }}
        restore-keys: prebuilts_misc@${{ env.branch }}
    - name: Clone project prebuilts/misc
      if: steps.prebuilts_misc.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse_exclude prebuilts/misc "!/common/robolectric" "!/darwin-x86" "!/darwin-x86_64" "!/gdbserver"
    - name: Restore Cache prebuilts/ndk
      id: prebuilts_ndk
      uses: actions/cache@v3
      with:
        path: aosp/prebuilts/ndk
        key: prebuilts_ndk@${{ env.branch }}
        restore-keys: prebuilts_ndk@${{ env.branch }}
    - name: Clone project prebuilts/ndk
      if: steps.prebuilts_ndk.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse prebuilts/ndk current
    - name: Restore Cache prebuilts/rust
      id: prebuilts_rust
      uses: actions/cache@v3
      with:
        path: aosp/prebuilts/rust
        key: prebuilts_rust@${{ env.branch }}
        restore-keys: prebuilts_rust@${{ env.branch }}
    - name: Clone project prebuilts/rust
      if: steps.prebuilts_rust.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse prebuilts/rust bootstrap linux-x86/1.51.0
    - name: Restore Cache prebuilts/sdk
      id: prebuilts_sdk
      uses: actions/cache@v3
      with:
        path: aosp/prebuilts/sdk
        key: prebuilts_sdk@${{ env.branch }}
        restore-keys: prebuilts_sdk@${{ env.branch }}
    - name: Clone project prebuilts/sdk
      if: steps.prebuilts_sdk.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse_exclude prebuilts/sdk "!/tools/windows" "!/tools/darwin" "!/*/test/" "!/**/*.jar"
    - name: Restore Cache system/apex
      id: system_apex
      uses: actions/cache@v3
      with:
        path: aosp/system/apex
        key: system_apex@${{ env.branch }}
        restore-keys: system_apex@${{ env.branch }}
    - name: Clone project system/apex
      if: steps.system_apex.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/apex
    - name: Restore Cache system/bt
      id: system_bt
      uses: actions/cache@v3
      with:
        path: aosp/system/bt
        key: system_bt@${{ env.branch }}
        restore-keys: system_bt@${{ env.branch }}
    - name: Clone project system/bt
      if: steps.system_bt.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/bt
    - name: Restore Cache system/core
      id: system_core
      uses: actions/cache@v3
      with:
        path: aosp/system/core
        key: system_core@${{ env.branch }}
        restore-keys: system_core@${{ env.branch }}
    - name: Clone project system/core
      if: steps.system_core.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/core
    - name: Restore Cache system/gsid
      id: system_gsid
      uses: actions/cache@v3
      with:
        path: aosp/system/gsid
        key: system_gsid@${{ env.branch }}
        restore-keys: system_gsid@${{ env.branch }}
    - name: Clone project system/gsid
      if: steps.system_gsid.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/gsid
    - name: Restore Cache system/hardware/interfaces
      id: system_hardware_interfaces
      uses: actions/cache@v3
      with:
        path: aosp/system/hardware/interfaces
        key: system_hardware_interfaces@${{ env.branch }}
        restore-keys: system_hardware_interfaces@${{ env.branch }}
    - name: Clone project system/hardware/interfaces
      if: steps.system_hardware_interfaces.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/hardware/interfaces
    - name: Restore Cache system/incremental_delivery
      id: system_incremental_delivery
      uses: actions/cache@v3
      with:
        path: aosp/system/incremental_delivery
        key: system_incremental_delivery@${{ env.branch }}
        restore-keys: system_incremental_delivery@${{ env.branch }}
    - name: Clone project system/incremental_delivery
      if: steps.system_incremental_delivery.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/incremental_delivery
    - name: Restore Cache system/libhidl
      id: system_libhidl
      uses: actions/cache@v3
      with:
        path: aosp/system/libhidl
        key: system_libhidl@${{ env.branch }}
        restore-keys: system_libhidl@${{ env.branch }}
    - name: Clone project system/libhidl
      if: steps.system_libhidl.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/libhidl
    - name: Restore Cache system/libhwbinder
      id: system_libhwbinder
      uses: actions/cache@v3
      with:
        path: aosp/system/libhwbinder
        key: system_libhwbinder@${{ env.branch }}
        restore-keys: system_libhwbinder@${{ env.branch }}
    - name: Clone project system/libhwbinder
      if: steps.system_libhwbinder.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/libhwbinder
    - name: Restore Cache system/libsysprop
      id: system_libsysprop
      uses: actions/cache@v3
      with:
        path: aosp/system/libsysprop
        key: system_libsysprop@${{ env.branch }}
        restore-keys: system_libsysprop@${{ env.branch }}
    - name: Clone project system/libsysprop
      if: steps.system_libsysprop.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/libsysprop
    - name: Restore Cache system/logging
      id: system_logging
      uses: actions/cache@v3
      with:
        path: aosp/system/logging
        key: system_logging@${{ env.branch }}
        restore-keys: system_logging@${{ env.branch }}
    - name: Clone project system/logging
      if: steps.system_logging.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/logging
    - name: Restore Cache system/media
      id: system_media
      uses: actions/cache@v3
      with:
        path: aosp/system/media
        key: system_media@${{ env.branch }}
        restore-keys: system_media@${{ env.branch }}
    - name: Clone project system/media
      if: steps.system_media.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/media
    - name: Restore Cache system/netd
      id: system_netd
      uses: actions/cache@v3
      with:
        path: aosp/system/netd
        key: system_netd@${{ env.branch }}
        restore-keys: system_netd@${{ env.branch }}
    - name: Clone project system/netd
      if: steps.system_netd.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/netd
    - name: Restore Cache system/nfc
      id: system_nfc
      uses: actions/cache@v3
      with:
        path: aosp/system/nfc
        key: system_nfc@${{ env.branch }}
        restore-keys: system_nfc@${{ env.branch }}
    - name: Clone project system/nfc
      if: steps.system_nfc.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/nfc
    - name: Restore Cache system/security
      id: system_security
      uses: actions/cache@v3
      with:
        path: aosp/system/security
        key: system_security@${{ env.branch }}
        restore-keys: system_security@${{ env.branch }}
    - name: Clone project system/security
      if: steps.system_security.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/security
    - name: Restore Cache system/sepolicy
      id: system_sepolicy
      uses: actions/cache@v3
      with:
        path: aosp/system/sepolicy
        key: system_sepolicy@${{ env.branch }}
        restore-keys: system_sepolicy@${{ env.branch }}
    - name: Clone project system/sepolicy
      if: steps.system_sepolicy.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/sepolicy
    - name: Restore Cache system/tools/aidl
      id: system_tools_aidl
      uses: actions/cache@v3
      with:
        path: aosp/system/tools/aidl
        key: system_tools_aidl@${{ env.branch }}
        restore-keys: system_tools_aidl@${{ env.branch }}
    - name: Clone project system/tools/aidl
      if: steps.system_tools_aidl.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/tools/aidl
    - name: Restore Cache system/tools/hidl
      id: system_tools_hidl
      uses: actions/cache@v3
      with:
        path: aosp/system/tools/hidl
        key: system_tools_hidl@${{ env.branch }}
        restore-keys: system_tools_hidl@${{ env.branch }}
    - name: Clone project system/tools/hidl
      if: steps.system_tools_hidl.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/tools/hidl
    - name: Restore Cache system/tools/xsdc
      id: system_tools_xsdc
      uses: actions/cache@v3
      with:
        path: aosp/system/tools/xsdc
        key: system_tools_xsdc@${{ env.branch }}
        restore-keys: system_tools_xsdc@${{ env.branch }}
    - name: Clone project system/tools/xsdc
      if: steps.system_tools_xsdc.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/tools/xsdc
    - name: Restore Cache system/update_engine
      id: system_update_engine
      uses: actions/cache@v3
      with:
        path: aosp/system/update_engine
        key: system_update_engine@${{ env.branch }}
        restore-keys: system_update_engine@${{ env.branch }}
    - name: Clone project system/update_engine
      if: steps.system_update_engine.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/update_engine

    - name: Download Release
      run: |
        source $GITHUB_WORKSPACE/envsetup.sh
        download_release art-8 art/ android-12.0.0_r1-8
        download_release bionic-9 bionic/ android-12.0.0_r1-9
        download_release bootable_recovery-10 bootable/recovery/ android-12.0.0_r1-10
        download_release device_google_cuttlefish-10 device/google/cuttlefish/ android-12.0.0_r1-10
        download_release external_aac-5 external/aac/ android-12.0.0_r1-5
        download_release external_angle-4 external/angle/ android-12.0.0_r1-4
        download_release external_arm-optimized-routines-0 external/arm-optimized-routines/ android-12.0.0_r1-0
        download_release external_avb-10 external/avb/ android-12.0.0_r1-10
        download_release external_bcc-4 external/bcc/ android-12.0.0_r1-4
        download_release external_boringssl-4 external/boringssl/ android-12.0.0_r1-4
        download_release external_brotli-4 external/brotli/ android-12.0.0_r1-4
        download_release external_bsdiff-5 external/bsdiff/ android-12.0.0_r1-5
        download_release external_bzip2-2 external/bzip2/ android-12.0.0_r1-2
        download_release external_clang-5 external/clang/ android-12.0.0_r1-5
        download_release external_crosvm-10 external/crosvm/ android-12.0.0_r1-10
        download_release external_curl-5 external/curl/ android-12.0.0_r1-5
        download_release external_drm_hwcomposer-4 external/drm_hwcomposer/ android-12.0.0_r1-4
        download_release external_e2fsprogs-7 external/e2fsprogs/ android-12.0.0_r1-7
        download_release external_expat-2 external/expat/ android-12.0.0_r1-2
        download_release external_fec-4 external/fec/ android-12.0.0_r1-4
        download_release external_flac-4 external/flac/ android-12.0.0_r1-4
        download_release external_flatbuffers-4 external/flatbuffers/ android-12.0.0_r1-4
        download_release external_fmtlib-4 external/fmtlib/ android-12.0.0_r1-4
        download_release external_googletest-4 external/googletest/ android-12.0.0_r1-4
        download_release external_grpc-grpc-5 external/grpc-grpc/ android-12.0.0_r1-5
        download_release external_gwp_asan-5 external/gwp_asan/ android-12.0.0_r1-5
        download_release external_icu-6 external/icu/ android-12.0.0_r1-6
        download_release external_jsoncpp-4 external/jsoncpp/ android-12.0.0_r1-4
        download_release external_libavc-7 external/libavc/ android-12.0.0_r1-7
        download_release external_libbrillo-9 external/libbrillo/ android-12.0.0_r1-9
        download_release external_libcap-4 external/libcap/ android-12.0.0_r1-4
        download_release external_libchrome-8 external/libchrome/ android-12.0.0_r1-8
        download_release external_libchromeos-rs-10 external/libchromeos-rs/ android-12.0.0_r1-10
        download_release external_libcppbor-6 external/libcppbor/ android-12.0.0_r1-6
        download_release external_libcxx-3 external/libcxx/ android-12.0.0_r1-3
        download_release external_libcxxabi-2 external/libcxxabi/ android-12.0.0_r1-2
        download_release external_libdrm-4 external/libdrm/ android-12.0.0_r1-4
        download_release external_libevent-4 external/libevent/ android-12.0.0_r1-4
        download_release external_libexif-5 external/libexif/ android-12.0.0_r1-5
        download_release external_libgav1-4 external/libgav1/ android-12.0.0_r1-4
        download_release external_libgsm-4 external/libgsm/ android-12.0.0_r1-4
        download_release external_libhevc-4 external/libhevc/ android-12.0.0_r1-4
        download_release external_libjpeg-turbo-4 external/libjpeg-turbo/ android-12.0.0_r1-4
        download_release external_libldac-4 external/libldac/ android-12.0.0_r1-4
        download_release external_libmpeg2-7 external/libmpeg2/ android-12.0.0_r1-7
        download_release external_libopus-4 external/libopus/ android-12.0.0_r1-4
        download_release external_libpcap-4 external/libpcap/ android-12.0.0_r1-4
        download_release external_libpng-4 external/libpng/ android-12.0.0_r1-4
        download_release external_libvpx-4 external/libvpx/ android-12.0.0_r1-4
        download_release external_libxml2-7 external/libxml2/ android-12.0.0_r1-7
        download_release external_libyuv-5 external/libyuv/ android-12.0.0_r1-5
        download_release external_llvm-4 external/llvm/ android-12.0.0_r1-4 --exclude="libLLVMSupport" --exclude="libLLVMTableGen" --exclude="llvm-tblgen" --exclude="libLLVMAArch64AsmParser" --exclude="libLLVMAArch64AsmPrinter" --exclude="libLLVMAArch64CodeGen" --exclude="libLLVMAArch64Desc" --exclude="libLLVMAArch64Disassembler" --exclude="libLLVMAArch64Info" --exclude="libLLVMAArch64Utils" --exclude="libLLVMARMAsmParser" --exclude="libLLVMARMAsmPrinter" --exclude="libLLVMARMCodeGen" --exclude="libLLVMARMDesc" --exclude="libLLVMARMDisassembler" --exclude="libLLVMARMInfo" --exclude="libLLVMAnalysis" --exclude="libLLVMAsmParser" --exclude="libLLVMAsmPrinter" --exclude="libLLVMBitReader" --exclude="libLLVMBitWriter" --exclude="libLLVMCodeGen" --exclude="libLLVMCore" --exclude="libLLVMDebugInfoCodeView" --exclude="libLLVMDebugInfoDWARF" --exclude="libLLVMDebugInfoPDB" --exclude="libLLVMExecutionEngine" --exclude="libLLVMGlobalISel" --exclude="libLLVMIRReader" --exclude="libLLVMInstCombine" --exclude="libLLVMInstrumentation" --exclude="libLLVMLTO" --exclude="libLLVMLibDriver" --exclude="libLLVMLinker" --exclude="libLLVMMC" --exclude="libLLVMMCDisassembler" --exclude="libLLVMMCJIT" --exclude="libLLVMMCParser" --exclude="libLLVMObject" --exclude="libLLVMOption" --exclude="libLLVMOrcJIT" --exclude="libLLVMProfileData" --exclude="libLLVMProfileDataCoverage" --exclude="libLLVMRuntimeDyld" --exclude="libLLVMScalarOpts" --exclude="libLLVMSelectionDAG" --exclude="libLLVMSymbolize" --exclude="libLLVMTarget" --exclude="libLLVMTransformObjCARC" --exclude="libLLVMTransformUtils" --exclude="libLLVMVectorize" --exclude="libLLVMX86AsmParser" --exclude="libLLVMX86AsmPrinter" --exclude="libLLVMX86CodeGen" --exclude="libLLVMX86Desc" --exclude="libLLVMX86Disassembler" --exclude="libLLVMX86Info" --exclude="libLLVMX86Utils" --exclude="libLLVMipo"
        rm -rf external_llvm-4.tar.xz
        download_release external_mdnsresponder-7 external/mdnsresponder/ android-12.0.0_r1-7
        download_release external_minigbm-5 external/minigbm/ android-12.0.0_r1-5
        download_release external_minijail-6 external/minijail/ android-12.0.0_r1-6
        download_release external_modp_b64-4 external/modp_b64/ android-12.0.0_r1-4
        download_release external_parameter-framework-8 external/parameter-framework/ android-12.0.0_r1-8
        download_release external_pcre-2 external/pcre/ android-12.0.0_r1-2
        download_release external_perfetto-10 external/perfetto/ android-12.0.0_r1-10
        download_release external_protobuf-5 external/protobuf/ android-12.0.0_r1-5
        download_release external_puffin-9 external/puffin/ android-12.0.0_r1-9
        download_release external_python_cpython2-8 external/python/cpython2/ android-12.0.0_r1-8
        download_release external_rust_crates_android_log-sys-5 external/rust/crates/android_log-sys/ android-12.0.0_r1-5
        download_release external_rust_crates_android_logger-8 external/rust/crates/android_logger/ android-12.0.0_r1-8
        download_release external_rust_crates_anyhow-5 external/rust/crates/anyhow/ android-12.0.0_r1-5
        download_release external_rust_crates_bindgen-8 external/rust/crates/bindgen/ android-12.0.0_r1-8
        download_release external_rust_crates_bitflags-5 external/rust/crates/bitflags/ android-12.0.0_r1-5
        download_release external_rust_crates_bytes-0 external/rust/crates/bytes/ android-12.0.0_r1-0
        download_release external_rust_crates_cfg-if-5 external/rust/crates/cfg-if/ android-12.0.0_r1-5
        download_release external_rust_crates_clap-6 external/rust/crates/clap/ android-12.0.0_r1-6
        download_release external_rust_crates_env_logger-7 external/rust/crates/env_logger/ android-12.0.0_r1-7
        download_release external_rust_crates_fallible-iterator-0 external/rust/crates/fallible-iterator/ android-12.0.0_r1-0
        download_release external_rust_crates_fallible-streaming-iterator-0 external/rust/crates/fallible-streaming-iterator/ android-12.0.0_r1-0
        download_release external_rust_crates_futures-channel-6 external/rust/crates/futures-channel/ android-12.0.0_r1-6
        download_release external_rust_crates_futures-core-5 external/rust/crates/futures-core/ android-12.0.0_r1-5
        download_release external_rust_crates_futures-executor-8 external/rust/crates/futures-executor/ android-12.0.0_r1-8
        download_release external_rust_crates_futures-io-5 external/rust/crates/futures-io/ android-12.0.0_r1-5
        download_release external_rust_crates_futures-sink-5 external/rust/crates/futures-sink/ android-12.0.0_r1-5
        download_release external_rust_crates_futures-task-5 external/rust/crates/futures-task/ android-12.0.0_r1-5
        download_release external_rust_crates_futures-util-7 external/rust/crates/futures-util/ android-12.0.0_r1-7
        download_release external_rust_crates_futures-9 external/rust/crates/futures/ android-12.0.0_r1-9
        download_release external_rust_crates_grpcio-compiler-2 external/rust/crates/grpcio-compiler/ android-12.0.0_r1-2
        download_release external_rust_crates_grpcio-sys-9 external/rust/crates/grpcio-sys/ android-12.0.0_r1-9
        download_release external_rust_crates_grpcio-10 external/rust/crates/grpcio/ android-12.0.0_r1-10
        download_release external_rust_crates_hashlink-9 external/rust/crates/hashlink/ android-12.0.0_r1-9
        download_release external_rust_crates_intrusive-collections-6 external/rust/crates/intrusive-collections/ android-12.0.0_r1-6
        download_release external_rust_crates_lazy_static-5 external/rust/crates/lazy_static/ android-12.0.0_r1-5
        download_release external_rust_crates_libc-5 external/rust/crates/libc/ android-12.0.0_r1-5
        download_release external_rust_crates_libsqlite3-sys-9 external/rust/crates/libsqlite3-sys/ android-12.0.0_r1-9
        download_release external_rust_crates_log-6 external/rust/crates/log/ android-12.0.0_r1-6
        download_release external_rust_crates_memchr-5 external/rust/crates/memchr/ android-12.0.0_r1-5
        download_release external_rust_crates_mio-7 external/rust/crates/mio/ android-12.0.0_r1-7
        download_release external_rust_crates_nix-6 external/rust/crates/nix/ android-12.0.0_r1-6
        download_release external_rust_crates_num-derive-5 external/rust/crates/num-derive/ android-12.0.0_r1-5
        download_release external_rust_crates_num-traits-5 external/rust/crates/num-traits/ android-12.0.0_r1-5
        download_release external_rust_crates_num_cpus-6 external/rust/crates/num_cpus/ android-12.0.0_r1-6
        download_release external_rust_crates_parking_lot-8 external/rust/crates/parking_lot/ android-12.0.0_r1-8
        download_release external_rust_crates_paste-0 external/rust/crates/paste/ android-12.0.0_r1-0
        download_release external_rust_crates_pin-project-lite-5 external/rust/crates/pin-project-lite/ android-12.0.0_r1-5
        download_release external_rust_crates_proc-macro2-1 external/rust/crates/proc-macro2/ android-12.0.0_r1-1
        download_release external_rust_crates_protobuf-codegen-2 external/rust/crates/protobuf-codegen/ android-12.0.0_r1-2
        download_release external_rust_crates_protobuf-1 external/rust/crates/protobuf/ android-12.0.0_r1-1
        download_release external_rust_crates_quote-2 external/rust/crates/quote/ android-12.0.0_r1-2
        download_release external_rust_crates_rand-9 external/rust/crates/rand/ android-12.0.0_r1-9
        download_release external_rust_crates_rand_chacha-8 external/rust/crates/rand_chacha/ android-12.0.0_r1-8
        download_release external_rust_crates_rand_core-7 external/rust/crates/rand_core/ android-12.0.0_r1-7
        download_release external_rust_crates_rusqlite-10 external/rust/crates/rusqlite/ android-12.0.0_r1-10
        download_release external_rust_crates_smallvec-5 external/rust/crates/smallvec/ android-12.0.0_r1-5
        download_release external_rust_crates_structopt-derive-5 external/rust/crates/structopt-derive/ android-12.0.0_r1-5
        download_release external_rust_crates_structopt-7 external/rust/crates/structopt/ android-12.0.0_r1-7
        download_release external_rust_crates_syn-3 external/rust/crates/syn/ android-12.0.0_r1-3
        download_release external_rust_crates_thiserror-impl-4 external/rust/crates/thiserror-impl/ android-12.0.0_r1-4
        download_release external_rust_crates_thiserror-5 external/rust/crates/thiserror/ android-12.0.0_r1-5
        download_release external_rust_crates_tokio-macros-5 external/rust/crates/tokio-macros/ android-12.0.0_r1-5
        download_release external_rust_crates_tokio-8 external/rust/crates/tokio/ android-12.0.0_r1-8
        download_release external_rust_cxx-7 external/rust/cxx/ android-12.0.0_r1-7
        download_release external_scudo-0 external/scudo/ android-12.0.0_r1-0
        download_release external_selinux-9 external/selinux/ android-12.0.0_r1-9
        download_release external_sonic-4 external/sonic/ android-12.0.0_r1-4
        download_release external_speex-4 external/speex/ android-12.0.0_r1-4
        download_release external_sqlite-7 external/sqlite/ android-12.0.0_r1-7
        download_release external_swiftshader-7 external/swiftshader/ android-12.0.0_r1-7 --exclude="libswiftshader_compiler" --exclude="libswiftshader_llvm" --exclude="libEGL_swiftshader" --exclude="libGLESv1_CM_swiftshader" --exclude="libGLESv2_swiftshader" --exclude="vulkan.pastel"
        rm -rf external_swiftshader-7.tar.xz
        download_release external_tinyxml2-5 external/tinyxml2/ android-12.0.0_r1-5
        download_release external_tremolo-5 external/tremolo/ android-12.0.0_r1-5
        download_release external_vm_tools_p9-5 external/vm_tools/p9/ android-12.0.0_r1-5
        download_release external_xz-embedded-4 external/xz-embedded/ android-12.0.0_r1-4
        download_release external_zlib-2 external/zlib/ android-12.0.0_r1-2
        download_release frameworks_av-10 frameworks/av/ android-12.0.0_r1-10
        download_release frameworks_base-10 frameworks/base/ android-12.0.0_r1-10
        download_release frameworks_compile_libbcc-7 frameworks/compile/libbcc/ android-12.0.0_r1-7
        download_release frameworks_compile_slang-8 frameworks/compile/slang/ android-12.0.0_r1-8
        download_release frameworks_native-10 frameworks/native/ android-12.0.0_r1-10
        download_release frameworks_proto_logging-10 frameworks/proto_logging/ android-12.0.0_r1-10
        download_release frameworks_rs-9 frameworks/rs/ android-12.0.0_r1-9
        download_release hardware_google_camera-7 hardware/google/camera/ android-12.0.0_r1-7
        download_release hardware_interfaces-10 hardware/interfaces/ android-12.0.0_r1-10
        download_release hardware_libhardware-10 hardware/libhardware/ android-12.0.0_r1-10
        download_release hardware_libhardware_legacy-9 hardware/libhardware_legacy/ android-12.0.0_r1-9
        download_release libnativehelper-5 libnativehelper/ android-12.0.0_r1-5
        download_release packages_modules_DnsResolver-10 packages/modules/DnsResolver/ android-12.0.0_r1-10
        download_release packages_modules_Gki-6 packages/modules/Gki/ android-12.0.0_r1-6
        download_release packages_modules_NeuralNetworks-9 packages/modules/NeuralNetworks/ android-12.0.0_r1-9
        download_release packages_modules_StatsD-10 packages/modules/StatsD/ android-12.0.0_r1-10
        download_release packages_modules_Virtualization-9 packages/modules/Virtualization/ android-12.0.0_r1-9
        download_release system_apex-7 system/apex/ android-12.0.0_r1-7
        download_release system_bpf-7 system/bpf/ android-12.0.0_r1-7
        download_release system_bt-9 system/bt/ android-12.0.0_r1-9
        download_release system_core-10 system/core/ android-12.0.0_r1-10
        download_release system_extras-10 system/extras/ android-12.0.0_r1-10
        download_release system_gsid-9 system/gsid/ android-12.0.0_r1-9
        download_release system_hardware_interfaces-9 system/hardware/interfaces/ android-12.0.0_r1-9
        download_release system_incremental_delivery-8 system/incremental_delivery/ android-12.0.0_r1-8
        download_release system_keymaster-9 system/keymaster/ android-12.0.0_r1-9
        download_release system_libbase-5 system/libbase/ android-12.0.0_r1-5
        download_release system_libfmq-7 system/libfmq/ android-12.0.0_r1-7
        download_release system_libhidl-9 system/libhidl/ android-12.0.0_r1-9
        download_release system_libhwbinder-7 system/libhwbinder/ android-12.0.0_r1-7
        download_release system_libprocinfo-6 system/libprocinfo/ android-12.0.0_r1-6
        download_release system_libvintf-9 system/libvintf/ android-12.0.0_r1-9
        download_release system_libziparchive-6 system/libziparchive/ android-12.0.0_r1-6
        download_release system_logging-9 system/logging/ android-12.0.0_r1-9
        download_release system_media-7 system/media/ android-12.0.0_r1-7
        download_release system_memory_libdmabufheap-7 system/memory/libdmabufheap/ android-12.0.0_r1-7
        download_release system_memory_libion-5 system/memory/libion/ android-12.0.0_r1-5
        download_release system_memory_libmeminfo-8 system/memory/libmeminfo/ android-12.0.0_r1-8
        download_release system_memory_libmemunreachable-7 system/memory/libmemunreachable/ android-12.0.0_r1-7
        download_release system_netd-9 system/netd/ android-12.0.0_r1-9
        download_release system_nfc-6 system/nfc/ android-12.0.0_r1-6
        download_release system_security-10 system/security/ android-12.0.0_r1-10
        download_release system_server_configurable_flags-7 system/server_configurable_flags/ android-12.0.0_r1-7
        download_release system_tools_aidl-9 system/tools/aidl/ android-12.0.0_r1-9
        download_release system_tools_sysprop-7 system/tools/sysprop/ android-12.0.0_r1-7
        download_release system_tools_xsdc-6 system/tools/xsdc/ android-12.0.0_r1-6
        download_release system_unwinding-7 system/unwinding/ android-12.0.0_r1-7
        download_release system_update_engine-10 system/update_engine/ android-12.0.0_r1-10
        download_release system_vold-10 system/vold/ android-12.0.0_r1-10
    - name: Start Soong
      run: |
        pushd aosp
        export TOP=$(pwd)
        cp build/make/core/root.mk Makefile
        ln -sf make/CleanSpec.mk build/ && ln -sf make/core build/
        ln -sf make/target build/ && ln -sf make/tools build/
        ln -sf build/soong/root.bp Android.bp
        mkdir -p prebuilts/go && touch prebuilts/go/.out-dir
        ln -sf $GOROOT_1_19_X64 prebuilts/go/linux-x86
        mkdir -p out/soong/.minibootstrap out/soong/.bootstrap/bin
        ln -sf $GITHUB_WORKSPACE/soong_build out/soong/.bootstrap/bin
        ln -sf $GITHUB_WORKSPACE/bpglob out/soong/.minibootstrap
        cp $GITHUB_WORKSPACE/ckati prebuilts/build-tools/linux-x86/bin
        mkdir -p prebuiltlibs && cp $GITHUB_WORKSPACE/Android.bp prebuiltlibs/
        mkdir -p prebuiltlibs && cp $GITHUB_WORKSPACE/rust_prebuilt.list prebuiltlibs/
        sed -i 's/libLLVM_android.so"],/libLLVM_android.so"],\n}, android_x86_64: { srcs: ["libLLVM_android.so"], }, android_x86: { srcs: ["libLLVM_android.so"],/g' prebuilts/sdk/tools/Android.bp
        sed -i 's/name: "libLLVM_android",/name: "libLLVM_android",\n device_supported: true, prefer: true,/g' prebuilts/sdk/tools/Android.bp
        mv prebuiltlibs/external/llvm/libLLVM_android/android_x86_64_shared/libLLVM_android.so prebuilts/sdk/tools/
        echo "eng.buildbot.$(date '+%Y%m%d.%H%M%S')" > out/soong/build_number.txt
        GOROOT=$TOP/prebuilts/go/linux-x86 $GITHUB_WORKSPACE/soong_ui --make-mode --skip-ninja --skip-kati --skip-soong-tests --skip-write-modules -j1 TARGET_PRODUCT=aosp_x86_64 TARGET_BUILD_VARIANT=eng ALLOW_MISSING_DEPENDENCIES=true BUILD_BROKEN_DISABLE_BAZEL=1 nothing
        $GITHUB_WORKSPACE/build.sh
        du -ah -d1 out/soong |sort -h
        du -ah -d1 . |sort -h

    - name: Archive bootable_recovery-11.tar.xz
      uses: actions/upload-artifact@v3
      with:
        name: bootable_recovery-11.tar.xz
        path: aosp/bootable_recovery-11.tar.xz
    - name: Archive device_generic_vulkan-cereal-11.tar.xz
      uses: actions/upload-artifact@v3
      with:
        name: device_generic_vulkan-cereal-11.tar.xz
        path: aosp/device_generic_vulkan-cereal-11.tar.xz
    - name: Archive device_google_cuttlefish-11.tar.xz
      uses: actions/upload-artifact@v3
      with:
        name: device_google_cuttlefish-11.tar.xz
        path: aosp/device_google_cuttlefish-11.tar.xz
    - name: Archive external_angle-11.tar.xz
      uses: actions/upload-artifact@v3
      with:
        name: external_angle-11.tar.xz
        path: aosp/external_angle-11.tar.xz
    - name: Archive external_drm_hwcomposer-11.tar.xz
      uses: actions/upload-artifact@v3
      with:
        name: external_drm_hwcomposer-11.tar.xz
        path: aosp/external_drm_hwcomposer-11.tar.xz
    - name: Archive external_minigbm-11.tar.xz
      uses: actions/upload-artifact@v3
      with:
        name: external_minigbm-11.tar.xz
        path: aosp/external_minigbm-11.tar.xz
    - name: Archive external_skia-11.tar.xz
      uses: actions/upload-artifact@v3
      with:
        name: external_skia-11.tar.xz
        path: aosp/external_skia-11.tar.xz
    - name: Archive external_swiftshader-11.tar.xz
      uses: actions/upload-artifact@v3
      with:
        name: external_swiftshader-11.tar.xz
        path: aosp/external_swiftshader-11.tar.xz
    - name: Archive external_vm_tools_p9-11.tar.xz
      uses: actions/upload-artifact@v3
      with:
        name: external_vm_tools_p9-11.tar.xz
        path: aosp/external_vm_tools_p9-11.tar.xz
    - name: Archive frameworks_av-11.tar.xz
      uses: actions/upload-artifact@v3
      with:
        name: frameworks_av-11.tar.xz
        path: aosp/frameworks_av-11.tar.xz
    - name: Archive frameworks_base-11.tar.xz
      uses: actions/upload-artifact@v3
      with:
        name: frameworks_base-11.tar.xz
        path: aosp/frameworks_base-11.tar.xz
    - name: Archive frameworks_native-11.tar.xz
      uses: actions/upload-artifact@v3
      with:
        name: frameworks_native-11.tar.xz
        path: aosp/frameworks_native-11.tar.xz
    - name: Archive frameworks_rs-11.tar.xz
      uses: actions/upload-artifact@v3
      with:
        name: frameworks_rs-11.tar.xz
        path: aosp/frameworks_rs-11.tar.xz
    - name: Archive hardware_google_camera-11.tar.xz
      uses: actions/upload-artifact@v3
      with:
        name: hardware_google_camera-11.tar.xz
        path: aosp/hardware_google_camera-11.tar.xz
    - name: Archive packages_apps_Gallery2-11.tar.xz
      uses: actions/upload-artifact@v3
      with:
        name: packages_apps_Gallery2-11.tar.xz
        path: aosp/packages_apps_Gallery2-11.tar.xz
    - name: Archive packages_modules_NeuralNetworks-11.tar.xz
      uses: actions/upload-artifact@v3
      with:
        name: packages_modules_NeuralNetworks-11.tar.xz
        path: aosp/packages_modules_NeuralNetworks-11.tar.xz
    - name: Archive packages_modules_Virtualization-11.tar.xz
      uses: actions/upload-artifact@v3
      with:
        name: packages_modules_Virtualization-11.tar.xz
        path: aosp/packages_modules_Virtualization-11.tar.xz
    - name: Archive system_apex-11.tar.xz
      uses: actions/upload-artifact@v3
      with:
        name: system_apex-11.tar.xz
        path: aosp/system_apex-11.tar.xz
    - name: Archive system_bt-11.tar.xz
      uses: actions/upload-artifact@v3
      with:
        name: system_bt-11.tar.xz
        path: aosp/system_bt-11.tar.xz
    - name: Archive system_core-11.tar.xz
      uses: actions/upload-artifact@v3
      with:
        name: system_core-11.tar.xz
        path: aosp/system_core-11.tar.xz
    - name: Archive system_gsid-11.tar.xz
      uses: actions/upload-artifact@v3
      with:
        name: system_gsid-11.tar.xz
        path: aosp/system_gsid-11.tar.xz
    - name: Archive system_netd-11.tar.xz
      uses: actions/upload-artifact@v3
      with:
        name: system_netd-11.tar.xz
        path: aosp/system_netd-11.tar.xz
    - name: Archive system_nfc-11.tar.xz
      uses: actions/upload-artifact@v3
      with:
        name: system_nfc-11.tar.xz
        path: aosp/system_nfc-11.tar.xz
    - name: Archive system_security-11.tar.xz
      uses: actions/upload-artifact@v3
      with:
        name: system_security-11.tar.xz
        path: aosp/system_security-11.tar.xz
    - name: Archive system_update_engine-11.tar.xz
      uses: actions/upload-artifact@v3
      with:
        name: system_update_engine-11.tar.xz
        path: aosp/system_update_engine-11.tar.xz

    - uses: softprops/action-gh-release@master
      with:
        name: ${{ env.branch }}-11
        tag_name: ${{ env.branch }}-11
        files: |
          aosp/bootable_recovery-11.tar.xz
          aosp/device_generic_vulkan-cereal-11.tar.xz
          aosp/device_google_cuttlefish-11.tar.xz
          aosp/external_angle-11.tar.xz
          aosp/external_drm_hwcomposer-11.tar.xz
          aosp/external_minigbm-11.tar.xz
          aosp/external_skia-11.tar.xz
          aosp/external_swiftshader-11.tar.xz
          aosp/external_vm_tools_p9-11.tar.xz
          aosp/frameworks_av-11.tar.xz
          aosp/frameworks_base-11.tar.xz
          aosp/frameworks_native-11.tar.xz
          aosp/frameworks_rs-11.tar.xz
          aosp/hardware_google_camera-11.tar.xz
          aosp/packages_apps_Gallery2-11.tar.xz
          aosp/packages_modules_NeuralNetworks-11.tar.xz
          aosp/packages_modules_Virtualization-11.tar.xz
          aosp/system_apex-11.tar.xz
          aosp/system_bt-11.tar.xz
          aosp/system_core-11.tar.xz
          aosp/system_gsid-11.tar.xz
          aosp/system_netd-11.tar.xz
          aosp/system_nfc-11.tar.xz
          aosp/system_security-11.tar.xz
          aosp/system_update_engine-11.tar.xz
