
name: AOSP Build
on:
  push:
    branches:
    - main
env:
  branch: 'android-12.0.0_r1'
jobs:
  build_step5:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@main
    - uses: actions/setup-python@v4
      with:
        python-version: "2.7"
    - name: Download get_clang_version.py
      run: |
        curl "https://android.googlesource.com/platform/build/soong/+/refs/heads/master/scripts/get_clang_version.py?format=TEXT" | base64 -d > $GITHUB_WORKSPACE/get_clang_version.py
        mkdir -p aosp

    - name: Restore Cache build/make
      id: build_make
      uses: actions/cache@v3
      with:
        path: aosp/build/make
        key: build_make@${{ env.branch }}
        restore-keys: build_make@${{ env.branch }}
    - name: Clone project build/make
      if: steps.build_make.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform build
        mv build make && mkdir build && mv make build/
        sed -i 's/^PRODUCT_EXTRA_VNDK_VERSIONS/#PRODUCT_EXTRA_VNDK_VERSIONS/g' build/make/target/product/gsi_release.mk
    - name: Restore Cache art
      id: art
      uses: actions/cache@v3
      with:
        path: aosp/art
        key: art@${{ env.branch }}
        restore-keys: art@${{ env.branch }}
    - name: Clone project art
      if: steps.art.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform art
    - name: Restore Cache bionic
      id: bionic
      uses: actions/cache@v3
      with:
        path: aosp/bionic
        key: bionic@${{ env.branch }}
        restore-keys: bionic@${{ env.branch }}
    - name: Clone project bionic
      if: steps.bionic.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform bionic
    - name: Restore Cache build/blueprint
      id: build_blueprint
      uses: actions/cache@v3
      with:
        path: aosp/build/blueprint
        key: build_blueprint@${{ env.branch }}
        restore-keys: build_blueprint@${{ env.branch }}
    - name: Clone project build/blueprint
      if: steps.build_blueprint.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform build/blueprint
    - name: Restore Cache build/soong
      id: build_soong
      uses: actions/cache@v3
      with:
        path: aosp/build/soong
        key: build_soong@${{ env.branch }}
        restore-keys: build_soong@${{ env.branch }}
    - name: Clone project build/soong
      if: steps.build_soong.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform build/soong
    - name: Restore Cache device/generic/goldfish-opengl
      id: device_generic_goldfish-opengl
      uses: actions/cache@v3
      with:
        path: aosp/device/generic/goldfish-opengl
        key: device_generic_goldfish-opengl@${{ env.branch }}
        restore-keys: device_generic_goldfish-opengl@${{ env.branch }}
    - name: Clone project device/generic/goldfish-opengl
      if: steps.device_generic_goldfish-opengl.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth device/generic/goldfish-opengl
    - name: Restore Cache external/aac
      id: external_aac
      uses: actions/cache@v3
      with:
        path: aosp/external/aac
        key: external_aac@${{ env.branch }}
        restore-keys: external_aac@${{ env.branch }}
    - name: Clone project external/aac
      if: steps.external_aac.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/aac
    - name: Restore Cache external/avb
      id: external_avb
      uses: actions/cache@v3
      with:
        path: aosp/external/avb
        key: external_avb@${{ env.branch }}
        restore-keys: external_avb@${{ env.branch }}
    - name: Clone project external/avb
      if: steps.external_avb.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/avb
    - name: Restore Cache external/bsdiff
      id: external_bsdiff
      uses: actions/cache@v3
      with:
        path: aosp/external/bsdiff
        key: external_bsdiff@${{ env.branch }}
        restore-keys: external_bsdiff@${{ env.branch }}
    - name: Clone project external/bsdiff
      if: steps.external_bsdiff.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/bsdiff
    - name: Restore Cache external/cblas
      id: external_cblas
      uses: actions/cache@v3
      with:
        path: aosp/external/cblas
        key: external_cblas@${{ env.branch }}
        restore-keys: external_cblas@${{ env.branch }}
    - name: Clone project external/cblas
      if: steps.external_cblas.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/cblas
    - name: Restore Cache external/clang
      id: external_clang
      uses: actions/cache@v3
      with:
        path: aosp/external/clang
        key: external_clang@${{ env.branch }}
        restore-keys: external_clang@${{ env.branch }}
    - name: Clone project external/clang
      if: steps.external_clang.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/clang
    - name: Restore Cache external/compiler-rt
      id: external_compiler-rt
      uses: actions/cache@v3
      with:
        path: aosp/external/compiler-rt
        key: external_compiler-rt@${{ env.branch }}
        restore-keys: external_compiler-rt@${{ env.branch }}
    - name: Clone project external/compiler-rt
      if: steps.external_compiler-rt.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/compiler-rt
    - name: Restore Cache external/conscrypt
      id: external_conscrypt
      uses: actions/cache@v3
      with:
        path: aosp/external/conscrypt
        key: external_conscrypt@${{ env.branch }}
        restore-keys: external_conscrypt@${{ env.branch }}
    - name: Clone project external/conscrypt
      if: steps.external_conscrypt.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/conscrypt
    - name: Restore Cache external/crosvm
      id: external_crosvm
      uses: actions/cache@v3
      with:
        path: aosp/external/crosvm
        key: external_crosvm@${{ env.branch }}
        restore-keys: external_crosvm@${{ env.branch }}
    - name: Clone project external/crosvm
      if: steps.external_crosvm.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/crosvm
    - name: Restore Cache external/curl
      id: external_curl
      uses: actions/cache@v3
      with:
        path: aosp/external/curl
        key: external_curl@${{ env.branch }}
        restore-keys: external_curl@${{ env.branch }}
    - name: Clone project external/curl
      if: steps.external_curl.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/curl
    - name: Restore Cache external/dng_sdk
      id: external_dng_sdk
      uses: actions/cache@v3
      with:
        path: aosp/external/dng_sdk
        key: external_dng_sdk@${{ env.branch }}
        restore-keys: external_dng_sdk@${{ env.branch }}
    - name: Clone project external/dng_sdk
      if: steps.external_dng_sdk.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/dng_sdk
    - name: Restore Cache external/freetype
      id: external_freetype
      uses: actions/cache@v3
      with:
        path: aosp/external/freetype
        key: external_freetype@${{ env.branch }}
        restore-keys: external_freetype@${{ env.branch }}
    - name: Clone project external/freetype
      if: steps.external_freetype.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/freetype
    - name: Restore Cache external/fsverity-utils
      id: external_fsverity-utils
      uses: actions/cache@v3
      with:
        path: aosp/external/fsverity-utils
        key: external_fsverity-utils@${{ env.branch }}
        restore-keys: external_fsverity-utils@${{ env.branch }}
    - name: Clone project external/fsverity-utils
      if: steps.external_fsverity-utils.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/fsverity-utils
    - name: Restore Cache external/giflib
      id: external_giflib
      uses: actions/cache@v3
      with:
        path: aosp/external/giflib
        key: external_giflib@${{ env.branch }}
        restore-keys: external_giflib@${{ env.branch }}
    - name: Clone project external/giflib
      if: steps.external_giflib.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/giflib
    - name: Restore Cache external/golang-protobuf
      id: external_golang-protobuf
      uses: actions/cache@v3
      with:
        path: aosp/external/golang-protobuf
        key: external_golang-protobuf@${{ env.branch }}
        restore-keys: external_golang-protobuf@${{ env.branch }}
    - name: Clone project external/golang-protobuf
      if: steps.external_golang-protobuf.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/golang-protobuf
    - name: Restore Cache external/gptfdisk
      id: external_gptfdisk
      uses: actions/cache@v3
      with:
        path: aosp/external/gptfdisk
        key: external_gptfdisk@${{ env.branch }}
        restore-keys: external_gptfdisk@${{ env.branch }}
    - name: Clone project external/gptfdisk
      if: steps.external_gptfdisk.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/gptfdisk
    - name: Restore Cache external/grpc-grpc
      id: external_grpc-grpc
      uses: actions/cache@v3
      with:
        path: aosp/external/grpc-grpc
        key: external_grpc-grpc@${{ env.branch }}
        restore-keys: external_grpc-grpc@${{ env.branch }}
    - name: Clone project external/grpc-grpc
      if: steps.external_grpc-grpc.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/grpc-grpc
    - name: Restore Cache external/image_io
      id: external_image_io
      uses: actions/cache@v3
      with:
        path: aosp/external/image_io
        key: external_image_io@${{ env.branch }}
        restore-keys: external_image_io@${{ env.branch }}
    - name: Clone project external/image_io
      if: steps.external_image_io.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/image_io
    - name: Restore Cache external/iputils
      id: external_iputils
      uses: actions/cache@v3
      with:
        path: aosp/external/iputils
        key: external_iputils@${{ env.branch }}
        restore-keys: external_iputils@${{ env.branch }}
    - name: Clone project external/iputils
      if: steps.external_iputils.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/iputils
    - name: Restore Cache external/iw
      id: external_iw
      uses: actions/cache@v3
      with:
        path: aosp/external/iw
        key: external_iw@${{ env.branch }}
        restore-keys: external_iw@${{ env.branch }}
    - name: Clone project external/iw
      if: steps.external_iw.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/iw
    - name: Restore Cache external/libcups
      id: external_libcups
      uses: actions/cache@v3
      with:
        path: aosp/external/libcups
        key: external_libcups@${{ env.branch }}
        restore-keys: external_libcups@${{ env.branch }}
    - name: Clone project external/libcups
      if: steps.external_libcups.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/libcups
    - name: Restore Cache external/libcxx
      id: external_libcxx
      uses: actions/cache@v3
      with:
        path: aosp/external/libcxx
        key: external_libcxx@${{ env.branch }}
        restore-keys: external_libcxx@${{ env.branch }}
    - name: Clone project external/libcxx
      if: steps.external_libcxx.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/libcxx
    - name: Restore Cache external/libcxxabi
      id: external_libcxxabi
      uses: actions/cache@v3
      with:
        path: aosp/external/libcxxabi
        key: external_libcxxabi@${{ env.branch }}
        restore-keys: external_libcxxabi@${{ env.branch }}
    - name: Clone project external/libcxxabi
      if: steps.external_libcxxabi.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/libcxxabi
    - name: Restore Cache external/libexif
      id: external_libexif
      uses: actions/cache@v3
      with:
        path: aosp/external/libexif
        key: external_libexif@${{ env.branch }}
        restore-keys: external_libexif@${{ env.branch }}
    - name: Clone project external/libexif
      if: steps.external_libexif.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/libexif
    - name: Restore Cache external/libffi
      id: external_libffi
      uses: actions/cache@v3
      with:
        path: aosp/external/libffi
        key: external_libffi@${{ env.branch }}
        restore-keys: external_libffi@${{ env.branch }}
    - name: Clone project external/libffi
      if: steps.external_libffi.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/libffi
    - name: Restore Cache external/libyuv
      id: external_libyuv
      uses: actions/cache@v3
      with:
        path: aosp/external/libyuv
        key: external_libyuv@${{ env.branch }}
        restore-keys: external_libyuv@${{ env.branch }}
    - name: Clone project external/libyuv
      if: steps.external_libyuv.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/libyuv
    - name: Restore Cache external/llvm
      id: external_llvm
      uses: actions/cache@v3
      with:
        path: aosp/external/llvm
        key: external_llvm@${{ env.branch }}
        restore-keys: external_llvm@${{ env.branch }}
    - name: Clone project external/llvm
      if: steps.external_llvm.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/llvm
    - name: Restore Cache external/mesa3d
      id: external_mesa3d
      uses: actions/cache@v3
      with:
        path: aosp/external/mesa3d
        key: external_mesa3d@${{ env.branch }}
        restore-keys: external_mesa3d@${{ env.branch }}
    - name: Clone project external/mesa3d
      if: steps.external_mesa3d.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/mesa3d
    - name: Restore Cache external/minigbm
      id: external_minigbm
      uses: actions/cache@v3
      with:
        path: aosp/external/minigbm
        key: external_minigbm@${{ env.branch }}
        restore-keys: external_minigbm@${{ env.branch }}
    - name: Clone project external/minigbm
      if: steps.external_minigbm.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/minigbm
    - name: Restore Cache external/minijail
      id: external_minijail
      uses: actions/cache@v3
      with:
        path: aosp/external/minijail
        key: external_minijail@${{ env.branch }}
        restore-keys: external_minijail@${{ env.branch }}
    - name: Clone project external/minijail
      if: steps.external_minijail.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/minijail
    - name: Restore Cache external/protobuf
      id: external_protobuf
      uses: actions/cache@v3
      with:
        path: aosp/external/protobuf
        key: external_protobuf@${{ env.branch }}
        restore-keys: external_protobuf@${{ env.branch }}
    - name: Clone project external/protobuf
      if: steps.external_protobuf.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/protobuf
    - name: Restore Cache external/python/cpython2
      id: external_python_cpython2
      uses: actions/cache@v3
      with:
        path: aosp/external/python/cpython2
        key: external_python_cpython2@${{ env.branch }}
        restore-keys: external_python_cpython2@${{ env.branch }}
    - name: Clone project external/python/cpython2
      if: steps.external_python_cpython2.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/python/cpython2
    - name: Restore Cache external/rust/crates/android_log-sys
      id: external_rust_crates_android_log-sys
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/android_log-sys
        key: external_rust_crates_android_log-sys@${{ env.branch }}
        restore-keys: external_rust_crates_android_log-sys@${{ env.branch }}
    - name: Clone project external/rust/crates/android_log-sys
      if: steps.external_rust_crates_android_log-sys.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/android_log-sys
    - name: Restore Cache external/rust/crates/anyhow
      id: external_rust_crates_anyhow
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/anyhow
        key: external_rust_crates_anyhow@${{ env.branch }}
        restore-keys: external_rust_crates_anyhow@${{ env.branch }}
    - name: Clone project external/rust/crates/anyhow
      if: steps.external_rust_crates_anyhow.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/anyhow
    - name: Restore Cache external/rust/crates/async-task
      id: external_rust_crates_async-task
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/async-task
        key: external_rust_crates_async-task@${{ env.branch }}
        restore-keys: external_rust_crates_async-task@${{ env.branch }}
    - name: Clone project external/rust/crates/async-task
      if: steps.external_rust_crates_async-task.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/async-task
    - name: Restore Cache external/rust/crates/bitflags
      id: external_rust_crates_bitflags
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/bitflags
        key: external_rust_crates_bitflags@${{ env.branch }}
        restore-keys: external_rust_crates_bitflags@${{ env.branch }}
    - name: Clone project external/rust/crates/bitflags
      if: steps.external_rust_crates_bitflags.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/bitflags
    - name: Restore Cache external/rust/crates/byteorder
      id: external_rust_crates_byteorder
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/byteorder
        key: external_rust_crates_byteorder@${{ env.branch }}
        restore-keys: external_rust_crates_byteorder@${{ env.branch }}
    - name: Clone project external/rust/crates/byteorder
      if: steps.external_rust_crates_byteorder.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/byteorder
    - name: Restore Cache external/rust/crates/cfg-if
      id: external_rust_crates_cfg-if
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/cfg-if
        key: external_rust_crates_cfg-if@${{ env.branch }}
        restore-keys: external_rust_crates_cfg-if@${{ env.branch }}
    - name: Clone project external/rust/crates/cfg-if
      if: steps.external_rust_crates_cfg-if.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/cfg-if
    - name: Restore Cache external/rust/crates/futures-core
      id: external_rust_crates_futures-core
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/futures-core
        key: external_rust_crates_futures-core@${{ env.branch }}
        restore-keys: external_rust_crates_futures-core@${{ env.branch }}
    - name: Clone project external/rust/crates/futures-core
      if: steps.external_rust_crates_futures-core.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/futures-core
    - name: Restore Cache external/rust/crates/futures-io
      id: external_rust_crates_futures-io
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/futures-io
        key: external_rust_crates_futures-io@${{ env.branch }}
        restore-keys: external_rust_crates_futures-io@${{ env.branch }}
    - name: Clone project external/rust/crates/futures-io
      if: steps.external_rust_crates_futures-io.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/futures-io
    - name: Restore Cache external/rust/crates/futures-sink
      id: external_rust_crates_futures-sink
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/futures-sink
        key: external_rust_crates_futures-sink@${{ env.branch }}
        restore-keys: external_rust_crates_futures-sink@${{ env.branch }}
    - name: Clone project external/rust/crates/futures-sink
      if: steps.external_rust_crates_futures-sink.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/futures-sink
    - name: Restore Cache external/rust/crates/futures-task
      id: external_rust_crates_futures-task
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/futures-task
        key: external_rust_crates_futures-task@${{ env.branch }}
        restore-keys: external_rust_crates_futures-task@${{ env.branch }}
    - name: Clone project external/rust/crates/futures-task
      if: steps.external_rust_crates_futures-task.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/futures-task
    - name: Restore Cache external/rust/crates/itoa
      id: external_rust_crates_itoa
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/itoa
        key: external_rust_crates_itoa@${{ env.branch }}
        restore-keys: external_rust_crates_itoa@${{ env.branch }}
    - name: Clone project external/rust/crates/itoa
      if: steps.external_rust_crates_itoa.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/itoa
    - name: Restore Cache external/rust/crates/lazy_static
      id: external_rust_crates_lazy_static
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/lazy_static
        key: external_rust_crates_lazy_static@${{ env.branch }}
        restore-keys: external_rust_crates_lazy_static@${{ env.branch }}
    - name: Clone project external/rust/crates/lazy_static
      if: steps.external_rust_crates_lazy_static.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/lazy_static
    - name: Restore Cache external/rust/crates/libc
      id: external_rust_crates_libc
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/libc
        key: external_rust_crates_libc@${{ env.branch }}
        restore-keys: external_rust_crates_libc@${{ env.branch }}
    - name: Clone project external/rust/crates/libc
      if: steps.external_rust_crates_libc.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/libc
    - name: Restore Cache external/rust/crates/memchr
      id: external_rust_crates_memchr
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/memchr
        key: external_rust_crates_memchr@${{ env.branch }}
        restore-keys: external_rust_crates_memchr@${{ env.branch }}
    - name: Clone project external/rust/crates/memchr
      if: steps.external_rust_crates_memchr.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/memchr
    - name: Restore Cache external/rust/crates/memoffset
      id: external_rust_crates_memoffset
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/memoffset
        key: external_rust_crates_memoffset@${{ env.branch }}
        restore-keys: external_rust_crates_memoffset@${{ env.branch }}
    - name: Clone project external/rust/crates/memoffset
      if: steps.external_rust_crates_memoffset.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/memoffset
    - name: Restore Cache external/rust/crates/num-traits
      id: external_rust_crates_num-traits
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/num-traits
        key: external_rust_crates_num-traits@${{ env.branch }}
        restore-keys: external_rust_crates_num-traits@${{ env.branch }}
    - name: Clone project external/rust/crates/num-traits
      if: steps.external_rust_crates_num-traits.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/num-traits
    - name: Restore Cache external/rust/crates/pin-project-lite
      id: external_rust_crates_pin-project-lite
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/pin-project-lite
        key: external_rust_crates_pin-project-lite@${{ env.branch }}
        restore-keys: external_rust_crates_pin-project-lite@${{ env.branch }}
    - name: Clone project external/rust/crates/pin-project-lite
      if: steps.external_rust_crates_pin-project-lite.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/pin-project-lite
    - name: Restore Cache external/rust/crates/pin-utils
      id: external_rust_crates_pin-utils
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/pin-utils
        key: external_rust_crates_pin-utils@${{ env.branch }}
        restore-keys: external_rust_crates_pin-utils@${{ env.branch }}
    - name: Clone project external/rust/crates/pin-utils
      if: steps.external_rust_crates_pin-utils.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/pin-utils
    - name: Restore Cache external/rust/crates/ppv-lite86
      id: external_rust_crates_ppv-lite86
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/ppv-lite86
        key: external_rust_crates_ppv-lite86@${{ env.branch }}
        restore-keys: external_rust_crates_ppv-lite86@${{ env.branch }}
    - name: Clone project external/rust/crates/ppv-lite86
      if: steps.external_rust_crates_ppv-lite86.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/ppv-lite86
    - name: Restore Cache external/rust/crates/proc-macro-nested
      id: external_rust_crates_proc-macro-nested
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/proc-macro-nested
        key: external_rust_crates_proc-macro-nested@${{ env.branch }}
        restore-keys: external_rust_crates_proc-macro-nested@${{ env.branch }}
    - name: Clone project external/rust/crates/proc-macro-nested
      if: steps.external_rust_crates_proc-macro-nested.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/proc-macro-nested
    - name: Restore Cache external/rust/crates/ryu
      id: external_rust_crates_ryu
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/ryu
        key: external_rust_crates_ryu@${{ env.branch }}
        restore-keys: external_rust_crates_ryu@${{ env.branch }}
    - name: Clone project external/rust/crates/ryu
      if: steps.external_rust_crates_ryu.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/ryu
    - name: Restore Cache external/rust/crates/serde
      id: external_rust_crates_serde
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/serde
        key: external_rust_crates_serde@${{ env.branch }}
        restore-keys: external_rust_crates_serde@${{ env.branch }}
    - name: Clone project external/rust/crates/serde
      if: steps.external_rust_crates_serde.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/serde
    - name: Restore Cache external/rust/crates/slab
      id: external_rust_crates_slab
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/slab
        key: external_rust_crates_slab@${{ env.branch }}
        restore-keys: external_rust_crates_slab@${{ env.branch }}
    - name: Clone project external/rust/crates/slab
      if: steps.external_rust_crates_slab.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/slab
    - name: Restore Cache external/rust/crates/smallvec
      id: external_rust_crates_smallvec
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/smallvec
        key: external_rust_crates_smallvec@${{ env.branch }}
        restore-keys: external_rust_crates_smallvec@${{ env.branch }}
    - name: Clone project external/rust/crates/smallvec
      if: steps.external_rust_crates_smallvec.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/smallvec
    - name: Restore Cache external/rust/crates/structopt-derive
      id: external_rust_crates_structopt-derive
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/structopt-derive
        key: external_rust_crates_structopt-derive@${{ env.branch }}
        restore-keys: external_rust_crates_structopt-derive@${{ env.branch }}
    - name: Clone project external/rust/crates/structopt-derive
      if: steps.external_rust_crates_structopt-derive.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/structopt-derive
    - name: Restore Cache external/rust/crates/textwrap
      id: external_rust_crates_textwrap
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/textwrap
        key: external_rust_crates_textwrap@${{ env.branch }}
        restore-keys: external_rust_crates_textwrap@${{ env.branch }}
    - name: Clone project external/rust/crates/textwrap
      if: steps.external_rust_crates_textwrap.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/textwrap
    - name: Restore Cache external/rust/crates/thiserror
      id: external_rust_crates_thiserror
      uses: actions/cache@v3
      with:
        path: aosp/external/rust/crates/thiserror
        key: external_rust_crates_thiserror@${{ env.branch }}
        restore-keys: external_rust_crates_thiserror@${{ env.branch }}
    - name: Clone project external/rust/crates/thiserror
      if: steps.external_rust_crates_thiserror.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/rust/crates/thiserror
    - name: Restore Cache external/scrypt
      id: external_scrypt
      uses: actions/cache@v3
      with:
        path: aosp/external/scrypt
        key: external_scrypt@${{ env.branch }}
        restore-keys: external_scrypt@${{ env.branch }}
    - name: Clone project external/scrypt
      if: steps.external_scrypt.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/scrypt
    - name: Restore Cache external/skia
      id: external_skia
      uses: actions/cache@v3
      with:
        path: aosp/external/skia
        key: external_skia@${{ env.branch }}
        restore-keys: external_skia@${{ env.branch }}
    - name: Clone project external/skia
      if: steps.external_skia.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/skia
    - name: Restore Cache external/sonivox
      id: external_sonivox
      uses: actions/cache@v3
      with:
        path: aosp/external/sonivox
        key: external_sonivox@${{ env.branch }}
        restore-keys: external_sonivox@${{ env.branch }}
    - name: Clone project external/sonivox
      if: steps.external_sonivox.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/sonivox
    - name: Restore Cache external/starlark-go
      id: external_starlark-go
      uses: actions/cache@v3
      with:
        path: aosp/external/starlark-go
        key: external_starlark-go@${{ env.branch }}
        restore-keys: external_starlark-go@${{ env.branch }}
    - name: Clone project external/starlark-go
      if: steps.external_starlark-go.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/starlark-go
    - name: Restore Cache external/swiftshader
      id: external_swiftshader
      uses: actions/cache@v3
      with:
        path: aosp/external/swiftshader
        key: external_swiftshader@${{ env.branch }}
        restore-keys: external_swiftshader@${{ env.branch }}
    - name: Clone project external/swiftshader
      if: steps.external_swiftshader.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/swiftshader
    - name: Restore Cache external/tcpdump
      id: external_tcpdump
      uses: actions/cache@v3
      with:
        path: aosp/external/tcpdump
        key: external_tcpdump@${{ env.branch }}
        restore-keys: external_tcpdump@${{ env.branch }}
    - name: Clone project external/tcpdump
      if: steps.external_tcpdump.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/tcpdump
    - name: Restore Cache external/tinyxml2
      id: external_tinyxml2
      uses: actions/cache@v3
      with:
        path: aosp/external/tinyxml2
        key: external_tinyxml2@${{ env.branch }}
        restore-keys: external_tinyxml2@${{ env.branch }}
    - name: Clone project external/tinyxml2
      if: steps.external_tinyxml2.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/tinyxml2
    - name: Restore Cache external/tremolo
      id: external_tremolo
      uses: actions/cache@v3
      with:
        path: aosp/external/tremolo
        key: external_tremolo@${{ env.branch }}
        restore-keys: external_tremolo@${{ env.branch }}
    - name: Clone project external/tremolo
      if: steps.external_tremolo.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/tremolo
    - name: Restore Cache external/wayland
      id: external_wayland
      uses: actions/cache@v3
      with:
        path: aosp/external/wayland
        key: external_wayland@${{ env.branch }}
        restore-keys: external_wayland@${{ env.branch }}
    - name: Clone project external/wayland
      if: steps.external_wayland.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform external/wayland
    - name: Restore Cache frameworks/av
      id: frameworks_av
      uses: actions/cache@v3
      with:
        path: aosp/frameworks/av
        key: frameworks_av@${{ env.branch }}
        restore-keys: frameworks_av@${{ env.branch }}
    - name: Clone project frameworks/av
      if: steps.frameworks_av.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform frameworks/av
    - name: Restore Cache frameworks/base
      id: frameworks_base
      uses: actions/cache@v3
      with:
        path: aosp/frameworks/base
        key: frameworks_base@${{ env.branch }}
        restore-keys: frameworks_base@${{ env.branch }}
    - name: Clone project frameworks/base
      if: steps.frameworks_base.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse_exclude frameworks/base "!/data/videos" "!/media/tests/contents" "!/docs" "!/native/graphics/jni/fuzz" "!/cmd/incidentd/testdata"
    - name: Restore Cache frameworks/compile/libbcc
      id: frameworks_compile_libbcc
      uses: actions/cache@v3
      with:
        path: aosp/frameworks/compile/libbcc
        key: frameworks_compile_libbcc@${{ env.branch }}
        restore-keys: frameworks_compile_libbcc@${{ env.branch }}
    - name: Clone project frameworks/compile/libbcc
      if: steps.frameworks_compile_libbcc.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform frameworks/compile/libbcc
    - name: Restore Cache frameworks/compile/mclinker
      id: frameworks_compile_mclinker
      uses: actions/cache@v3
      with:
        path: aosp/frameworks/compile/mclinker
        key: frameworks_compile_mclinker@${{ env.branch }}
        restore-keys: frameworks_compile_mclinker@${{ env.branch }}
    - name: Clone project frameworks/compile/mclinker
      if: steps.frameworks_compile_mclinker.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform frameworks/compile/mclinker
    - name: Restore Cache frameworks/native
      id: frameworks_native
      uses: actions/cache@v3
      with:
        path: aosp/frameworks/native
        key: frameworks_native@${{ env.branch }}
        restore-keys: frameworks_native@${{ env.branch }}
    - name: Clone project frameworks/native
      if: steps.frameworks_native.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform frameworks/native
    - name: Restore Cache frameworks/rs
      id: frameworks_rs
      uses: actions/cache@v3
      with:
        path: aosp/frameworks/rs
        key: frameworks_rs@${{ env.branch }}
        restore-keys: frameworks_rs@${{ env.branch }}
    - name: Clone project frameworks/rs
      if: steps.frameworks_rs.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform frameworks/rs
    - name: Restore Cache hardware/interfaces
      id: hardware_interfaces
      uses: actions/cache@v3
      with:
        path: aosp/hardware/interfaces
        key: hardware_interfaces@${{ env.branch }}
        restore-keys: hardware_interfaces@${{ env.branch }}
    - name: Clone project hardware/interfaces
      if: steps.hardware_interfaces.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform hardware/interfaces
    - name: Restore Cache hardware/libhardware
      id: hardware_libhardware
      uses: actions/cache@v3
      with:
        path: aosp/hardware/libhardware
        key: hardware_libhardware@${{ env.branch }}
        restore-keys: hardware_libhardware@${{ env.branch }}
    - name: Clone project hardware/libhardware
      if: steps.hardware_libhardware.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform hardware/libhardware
    - name: Restore Cache kernel/configs
      id: kernel_configs
      uses: actions/cache@v3
      with:
        path: aosp/kernel/configs
        key: kernel_configs@${{ env.branch }}
        restore-keys: kernel_configs@${{ env.branch }}
    - name: Clone project kernel/configs
      if: steps.kernel_configs.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth kernel/configs
    - name: Restore Cache libcore
      id: libcore
      uses: actions/cache@v3
      with:
        path: aosp/libcore
        key: libcore@${{ env.branch }}
        restore-keys: libcore@${{ env.branch }}
    - name: Clone project libcore
      if: steps.libcore.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform libcore
    - name: Restore Cache libnativehelper
      id: libnativehelper
      uses: actions/cache@v3
      with:
        path: aosp/libnativehelper
        key: libnativehelper@${{ env.branch }}
        restore-keys: libnativehelper@${{ env.branch }}
    - name: Clone project libnativehelper
      if: steps.libnativehelper.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform libnativehelper
    - name: Restore Cache packages/apps/Messaging
      id: packages_apps_Messaging
      uses: actions/cache@v3
      with:
        path: aosp/packages/apps/Messaging
        key: packages_apps_Messaging@${{ env.branch }}
        restore-keys: packages_apps_Messaging@${{ env.branch }}
    - name: Clone project packages/apps/Messaging
      if: steps.packages_apps_Messaging.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform packages/apps/Messaging
    - name: Restore Cache packages/modules/StatsD
      id: packages_modules_StatsD
      uses: actions/cache@v3
      with:
        path: aosp/packages/modules/StatsD
        key: packages_modules_StatsD@${{ env.branch }}
        restore-keys: packages_modules_StatsD@${{ env.branch }}
    - name: Clone project packages/modules/StatsD
      if: steps.packages_modules_StatsD.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform packages/modules/StatsD
    - name: Restore Cache packages/modules/common
      id: packages_modules_common
      uses: actions/cache@v3
      with:
        path: aosp/packages/modules/common
        key: packages_modules_common@${{ env.branch }}
        restore-keys: packages_modules_common@${{ env.branch }}
    - name: Clone project packages/modules/common
      if: steps.packages_modules_common.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform packages/modules/common
    - name: Restore Cache prebuilts/build-tools
      id: prebuilts_build-tools
      uses: actions/cache@v3
      with:
        path: aosp/prebuilts/build-tools
        key: prebuilts_build-tools@${{ env.branch }}
        restore-keys: prebuilts_build-tools@${{ env.branch }}
    - name: Clone project prebuilts/build-tools
      if: steps.prebuilts_build-tools.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse prebuilts/build-tools linux-x86/bin linux-x86/lib64 path common
    - name: Restore Cache prebuilts/clang-tools
      id: prebuilts_clang-tools
      uses: actions/cache@v3
      with:
        path: aosp/prebuilts/clang-tools
        key: prebuilts_clang-tools@${{ env.branch }}
        restore-keys: prebuilts_clang-tools@${{ env.branch }}
    - name: Clone project prebuilts/clang-tools
      if: steps.prebuilts_clang-tools.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse prebuilts/clang-tools linux-x86/bin linux-x86/lib64/clang
    - name: Restore Cache prebuilts/clang/host/linux-x86
      id: prebuilts_clang_host_linux-x86
      uses: actions/cache@v3
      with:
        path: aosp/prebuilts/clang/host/linux-x86
        key: prebuilts_clang_host_linux-x86@${{ env.branch }}
        restore-keys: prebuilts_clang_host_linux-x86@${{ env.branch }}
    - name: Clone project prebuilts/clang/host/linux-x86
      if: steps.prebuilts_clang_host_linux-x86.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse prebuilts/clang/host/linux-x86 $(python ${GITHUB_WORKSPACE}/get_clang_version.py) clang-r416183b soong
    - name: Restore Cache prebuilts/gcc/linux-x86/host/x86_64-linux-glibc2.17-4.8
      id: prebuilts_gcc_linux-x86_host_x86_64-linux-glibc2_17-4_8
      uses: actions/cache@v3
      with:
        path: aosp/prebuilts/gcc/linux-x86/host/x86_64-linux-glibc2.17-4.8
        key: prebuilts_gcc_linux-x86_host_x86_64-linux-glibc2_17-4_8@${{ env.branch }}
        restore-keys: prebuilts_gcc_linux-x86_host_x86_64-linux-glibc2_17-4_8@${{ env.branch }}
    - name: Clone project prebuilts/gcc/linux-x86/host/x86_64-linux-glibc2.17-4.8
      if: steps.prebuilts_gcc_linux-x86_host_x86_64-linux-glibc2_17-4_8.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse prebuilts/gcc/linux-x86/host/x86_64-linux-glibc2.17-4.8 sysroot lib/gcc/x86_64-linux/4.8.3 x86_64-linux/lib64 x86_64-linux/lib32
    - name: Restore Cache prebuilts/rust
      id: prebuilts_rust
      uses: actions/cache@v3
      with:
        path: aosp/prebuilts/rust
        key: prebuilts_rust@${{ env.branch }}
        restore-keys: prebuilts_rust@${{ env.branch }}
    - name: Clone project prebuilts/rust
      if: steps.prebuilts_rust.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse prebuilts/rust bootstrap linux-x86/1.51.0
    - name: Restore Cache prebuilts/sdk
      id: prebuilts_sdk
      uses: actions/cache@v3
      with:
        path: aosp/prebuilts/sdk
        key: prebuilts_sdk@${{ env.branch }}
        restore-keys: prebuilts_sdk@${{ env.branch }}
    - name: Clone project prebuilts/sdk
      if: steps.prebuilts_sdk.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_sparse_exclude prebuilts/sdk "!/tools/windows" "!/tools/darwin" "!/*/test/" "!/**/*.jar"
    - name: Restore Cache system/bt
      id: system_bt
      uses: actions/cache@v3
      with:
        path: aosp/system/bt
        key: system_bt@${{ env.branch }}
        restore-keys: system_bt@${{ env.branch }}
    - name: Clone project system/bt
      if: steps.system_bt.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/bt
    - name: Restore Cache system/core
      id: system_core
      uses: actions/cache@v3
      with:
        path: aosp/system/core
        key: system_core@${{ env.branch }}
        restore-keys: system_core@${{ env.branch }}
    - name: Clone project system/core
      if: steps.system_core.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/core
    - name: Restore Cache system/libbase
      id: system_libbase
      uses: actions/cache@v3
      with:
        path: aosp/system/libbase
        key: system_libbase@${{ env.branch }}
        restore-keys: system_libbase@${{ env.branch }}
    - name: Clone project system/libbase
      if: steps.system_libbase.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/libbase
    - name: Restore Cache system/logging
      id: system_logging
      uses: actions/cache@v3
      with:
        path: aosp/system/logging
        key: system_logging@${{ env.branch }}
        restore-keys: system_logging@${{ env.branch }}
    - name: Clone project system/logging
      if: steps.system_logging.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/logging
    - name: Restore Cache system/media
      id: system_media
      uses: actions/cache@v3
      with:
        path: aosp/system/media
        key: system_media@${{ env.branch }}
        restore-keys: system_media@${{ env.branch }}
    - name: Clone project system/media
      if: steps.system_media.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/media
    - name: Restore Cache system/memory/libion
      id: system_memory_libion
      uses: actions/cache@v3
      with:
        path: aosp/system/memory/libion
        key: system_memory_libion@${{ env.branch }}
        restore-keys: system_memory_libion@${{ env.branch }}
    - name: Clone project system/memory/libion
      if: steps.system_memory_libion.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/memory/libion
    - name: Restore Cache system/memory/lmkd
      id: system_memory_lmkd
      uses: actions/cache@v3
      with:
        path: aosp/system/memory/lmkd
        key: system_memory_lmkd@${{ env.branch }}
        restore-keys: system_memory_lmkd@${{ env.branch }}
    - name: Clone project system/memory/lmkd
      if: steps.system_memory_lmkd.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/memory/lmkd
    - name: Restore Cache system/security
      id: system_security
      uses: actions/cache@v3
      with:
        path: aosp/system/security
        key: system_security@${{ env.branch }}
        restore-keys: system_security@${{ env.branch }}
    - name: Clone project system/security
      if: steps.system_security.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/security
    - name: Restore Cache system/sepolicy
      id: system_sepolicy
      uses: actions/cache@v3
      with:
        path: aosp/system/sepolicy
        key: system_sepolicy@${{ env.branch }}
        restore-keys: system_sepolicy@${{ env.branch }}
    - name: Clone project system/sepolicy
      if: steps.system_sepolicy.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/sepolicy
    - name: Restore Cache system/tools/aidl
      id: system_tools_aidl
      uses: actions/cache@v3
      with:
        path: aosp/system/tools/aidl
        key: system_tools_aidl@${{ env.branch }}
        restore-keys: system_tools_aidl@${{ env.branch }}
    - name: Clone project system/tools/aidl
      if: steps.system_tools_aidl.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/tools/aidl
    - name: Restore Cache system/tools/hidl
      id: system_tools_hidl
      uses: actions/cache@v3
      with:
        path: aosp/system/tools/hidl
        key: system_tools_hidl@${{ env.branch }}
        restore-keys: system_tools_hidl@${{ env.branch }}
    - name: Clone project system/tools/hidl
      if: steps.system_tools_hidl.outputs.cache-hit != 'true'
      run: |
        cd aosp && source $GITHUB_WORKSPACE/envsetup.sh
        clone_depth_platform system/tools/hidl

    - name: Download Release
      run: |
        source $GITHUB_WORKSPACE/envsetup.sh
        download_release art-4 art/ android-12.0.0_r1-4
        download_release bionic-4 bionic/ android-12.0.0_r1-4
        download_release bootable_recovery-4 bootable/recovery/ android-12.0.0_r1-4
        download_release device_google_cuttlefish-4 device/google/cuttlefish/ android-12.0.0_r1-4
        download_release external_OpenCSD-4 external/OpenCSD/ android-12.0.0_r1-4
        download_release external_angle-4 external/angle/ android-12.0.0_r1-4
        download_release external_arm-optimized-routines-0 external/arm-optimized-routines/ android-12.0.0_r1-0
        download_release external_bc-2 external/bc/ android-12.0.0_r1-2
        download_release external_bcc-4 external/bcc/ android-12.0.0_r1-4
        download_release external_boringssl-4 external/boringssl/ android-12.0.0_r1-4
        download_release external_brotli-4 external/brotli/ android-12.0.0_r1-4
        download_release external_bsdiff-4 external/bsdiff/ android-12.0.0_r1-4
        download_release external_bzip2-2 external/bzip2/ android-12.0.0_r1-2
        download_release external_cn-cbor-4 external/cn-cbor/ android-12.0.0_r1-4
        download_release external_cpu_features-4 external/cpu_features/ android-12.0.0_r1-4
        download_release external_crosvm-4 external/crosvm/ android-12.0.0_r1-4
        download_release external_drm_hwcomposer-4 external/drm_hwcomposer/ android-12.0.0_r1-4
        download_release external_dtc-4 external/dtc/ android-12.0.0_r1-4
        download_release external_e2fsprogs-4 external/e2fsprogs/ android-12.0.0_r1-4
        download_release external_eigen-4 external/eigen/ android-12.0.0_r1-4
        download_release external_expat-2 external/expat/ android-12.0.0_r1-2
        download_release external_f2fs-tools-4 external/f2fs-tools/ android-12.0.0_r1-4
        download_release external_fdlibm-4 external/fdlibm/ android-12.0.0_r1-4
        download_release external_fec-4 external/fec/ android-12.0.0_r1-4
        download_release external_flac-4 external/flac/ android-12.0.0_r1-4
        download_release external_flatbuffers-4 external/flatbuffers/ android-12.0.0_r1-4
        download_release external_fmtlib-4 external/fmtlib/ android-12.0.0_r1-4
        download_release external_fsck_msdos-4 external/fsck_msdos/ android-12.0.0_r1-4
        download_release external_gemmlowp-4 external/gemmlowp/ android-12.0.0_r1-4
        download_release external_gflags-4 external/gflags/ android-12.0.0_r1-4
        download_release external_giflib-4 external/giflib/ android-12.0.0_r1-4
        download_release external_google-fruit-4 external/google-fruit/ android-12.0.0_r1-4
        download_release external_googletest-4 external/googletest/ android-12.0.0_r1-4
        download_release external_grpc-grpc-4 external/grpc-grpc/ android-12.0.0_r1-4
        download_release external_gwp_asan-4 external/gwp_asan/ android-12.0.0_r1-4
        download_release external_icu-4 external/icu/ android-12.0.0_r1-4
        download_release external_iperf3-4 external/iperf3/ android-12.0.0_r1-4
        download_release external_iproute2-4 external/iproute2/ android-12.0.0_r1-4
        download_release external_ipsec-tools-4 external/ipsec-tools/ android-12.0.0_r1-4
        download_release external_iptables-4 external/iptables/ android-12.0.0_r1-4
        download_release external_iputils-4 external/iputils/ android-12.0.0_r1-4
        download_release external_jsmn-4 external/jsmn/ android-12.0.0_r1-4
        download_release external_jsoncpp-4 external/jsoncpp/ android-12.0.0_r1-4
        download_release external_kmod-4 external/kmod/ android-12.0.0_r1-4
        download_release external_libcap-4 external/libcap/ android-12.0.0_r1-4
        download_release external_libcxx-3 external/libcxx/ android-12.0.0_r1-3
        download_release external_libcxxabi-2 external/libcxxabi/ android-12.0.0_r1-2
        download_release external_libdivsufsort-4 external/libdivsufsort/ android-12.0.0_r1-4
        download_release external_libdrm-4 external/libdrm/ android-12.0.0_r1-4
        download_release external_libepoxy-4 external/libepoxy/ android-12.0.0_r1-4
        download_release external_libevent-4 external/libevent/ android-12.0.0_r1-4
        download_release external_libffi-4 external/libffi/ android-12.0.0_r1-4
        download_release external_libgav1-4 external/libgav1/ android-12.0.0_r1-4
        download_release external_libgsm-4 external/libgsm/ android-12.0.0_r1-4
        download_release external_libhevc-4 external/libhevc/ android-12.0.0_r1-4
        download_release external_libjpeg-turbo-4 external/libjpeg-turbo/ android-12.0.0_r1-4
        download_release external_libldac-4 external/libldac/ android-12.0.0_r1-4
        download_release external_libnl-4 external/libnl/ android-12.0.0_r1-4
        download_release external_libogg-4 external/libogg/ android-12.0.0_r1-4
        download_release external_libopus-4 external/libopus/ android-12.0.0_r1-4
        download_release external_libpcap-4 external/libpcap/ android-12.0.0_r1-4
        download_release external_libpng-4 external/libpng/ android-12.0.0_r1-4
        download_release external_libtextclassifier-4 external/libtextclassifier/ android-12.0.0_r1-4
        download_release external_libvpx-4 external/libvpx/ android-12.0.0_r1-4
        download_release external_llvm-4 external/llvm/ android-12.0.0_r1-4 --exclude="libLLVMAArch64AsmParser" --exclude="libLLVMAArch64AsmPrinter" --exclude="libLLVMAArch64CodeGen" --exclude="libLLVMAArch64Desc" --exclude="libLLVMAArch64Disassembler" --exclude="libLLVMAArch64Info" --exclude="libLLVMAArch64Utils" --exclude="libLLVMARMAsmParser" --exclude="libLLVMARMAsmPrinter" --exclude="libLLVMARMCodeGen" --exclude="libLLVMARMDesc" --exclude="libLLVMARMDisassembler" --exclude="libLLVMARMInfo" --exclude="libLLVMAnalysis" --exclude="libLLVMAsmParser" --exclude="libLLVMAsmPrinter" --exclude="libLLVMBitReader" --exclude="libLLVMBitWriter" --exclude="libLLVMCodeGen" --exclude="libLLVMCore" --exclude="libLLVMDebugInfoCodeView" --exclude="libLLVMDebugInfoDWARF" --exclude="libLLVMDebugInfoPDB" --exclude="libLLVMExecutionEngine" --exclude="libLLVMGlobalISel" --exclude="libLLVMIRReader" --exclude="libLLVMInstCombine" --exclude="libLLVMInstrumentation" --exclude="libLLVMLTO" --exclude="libLLVMLibDriver" --exclude="libLLVMLinker" --exclude="libLLVMMC" --exclude="libLLVMMCDisassembler" --exclude="libLLVMMCJIT" --exclude="libLLVMMCParser" --exclude="libLLVMObject" --exclude="libLLVMOption" --exclude="libLLVMOrcJIT" --exclude="libLLVMProfileData" --exclude="libLLVMProfileDataCoverage" --exclude="libLLVMRuntimeDyld" --exclude="libLLVMScalarOpts" --exclude="libLLVMSelectionDAG" --exclude="libLLVMSymbolize" --exclude="libLLVMTarget" --exclude="libLLVMTransformObjCARC" --exclude="libLLVMTransformUtils" --exclude="libLLVMVectorize" --exclude="libLLVMX86AsmParser" --exclude="libLLVMX86AsmPrinter" --exclude="libLLVMX86CodeGen" --exclude="libLLVMX86Desc" --exclude="libLLVMX86Disassembler" --exclude="libLLVMX86Info" --exclude="libLLVMX86Utils" --exclude="libLLVMipo"
        rm -rf external_llvm-4.tar.xz
        download_release external_lz4-4 external/lz4/ android-12.0.0_r1-4
        download_release external_lzma-2 external/lzma/ android-12.0.0_r1-2
        download_release external_minijail-4 external/minijail/ android-12.0.0_r1-4
        download_release external_mksh-2 external/mksh/ android-12.0.0_r1-2
        download_release external_modp_b64-4 external/modp_b64/ android-12.0.0_r1-4
        download_release external_nanopb-c-4 external/nanopb-c/ android-12.0.0_r1-4
        download_release external_newfs_msdos-4 external/newfs_msdos/ android-12.0.0_r1-4
        download_release external_oj-libjdwp-4 external/oj-libjdwp/ android-12.0.0_r1-4
        download_release external_one-true-awk-2 external/one-true-awk/ android-12.0.0_r1-2
        download_release external_parameter-framework-4 external/parameter-framework/ android-12.0.0_r1-4
        download_release external_pcre-2 external/pcre/ android-12.0.0_r1-2
        download_release external_pdfium-4 external/pdfium/ android-12.0.0_r1-4
        download_release external_pffft-4 external/pffft/ android-12.0.0_r1-4
        download_release external_piex-4 external/piex/ android-12.0.0_r1-4
        download_release external_ppp-4 external/ppp/ android-12.0.0_r1-4
        download_release external_python_cpython2-4 external/python/cpython2/ android-12.0.0_r1-4
        download_release external_rnnoise-4 external/rnnoise/ android-12.0.0_r1-4
        download_release external_rust_crates_async-trait-4 external/rust/crates/async-trait/ android-12.0.0_r1-4
        download_release external_rust_crates_bytes-0 external/rust/crates/bytes/ android-12.0.0_r1-0
        download_release external_rust_crates_codespan-reporting-1 external/rust/crates/codespan-reporting/ android-12.0.0_r1-1
        download_release external_rust_crates_downcast-rs-0 external/rust/crates/downcast-rs/ android-12.0.0_r1-0
        download_release external_rust_crates_either-0 external/rust/crates/either/ android-12.0.0_r1-0
        download_release external_rust_crates_fallible-iterator-0 external/rust/crates/fallible-iterator/ android-12.0.0_r1-0
        download_release external_rust_crates_fallible-streaming-iterator-0 external/rust/crates/fallible-streaming-iterator/ android-12.0.0_r1-0
        download_release external_rust_crates_futures-macro-4 external/rust/crates/futures-macro/ android-12.0.0_r1-4
        download_release external_rust_crates_glob-0 external/rust/crates/glob/ android-12.0.0_r1-0
        download_release external_rust_crates_grpcio-compiler-2 external/rust/crates/grpcio-compiler/ android-12.0.0_r1-2
        download_release external_rust_crates_heck-1 external/rust/crates/heck/ android-12.0.0_r1-1
        download_release external_rust_crates_lazycell-0 external/rust/crates/lazycell/ android-12.0.0_r1-0
        download_release external_rust_crates_lock_api-1 external/rust/crates/lock_api/ android-12.0.0_r1-1
        download_release external_rust_crates_num-derive-4 external/rust/crates/num-derive/ android-12.0.0_r1-4
        download_release external_rust_crates_paste-0 external/rust/crates/paste/ android-12.0.0_r1-0
        download_release external_rust_crates_peeking_take_while-0 external/rust/crates/peeking_take_while/ android-12.0.0_r1-0
        download_release external_rust_crates_proc-macro-error-attr-3 external/rust/crates/proc-macro-error-attr/ android-12.0.0_r1-3
        download_release external_rust_crates_proc-macro-error-4 external/rust/crates/proc-macro-error/ android-12.0.0_r1-4
        download_release external_rust_crates_proc-macro-hack-0 external/rust/crates/proc-macro-hack/ android-12.0.0_r1-0
        download_release external_rust_crates_proc-macro2-1 external/rust/crates/proc-macro2/ android-12.0.0_r1-1
        download_release external_rust_crates_protobuf-codegen-2 external/rust/crates/protobuf-codegen/ android-12.0.0_r1-2
        download_release external_rust_crates_protobuf-1 external/rust/crates/protobuf/ android-12.0.0_r1-1
        download_release external_rust_crates_quote-2 external/rust/crates/quote/ android-12.0.0_r1-2
        download_release external_rust_crates_regex-syntax-0 external/rust/crates/regex-syntax/ android-12.0.0_r1-0
        download_release external_rust_crates_remain-4 external/rust/crates/remain/ android-12.0.0_r1-4
        download_release external_rust_crates_rustc-hash-0 external/rust/crates/rustc-hash/ android-12.0.0_r1-0
        download_release external_rust_crates_scopeguard-0 external/rust/crates/scopeguard/ android-12.0.0_r1-0
        download_release external_rust_crates_serde_derive-4 external/rust/crates/serde_derive/ android-12.0.0_r1-4
        download_release external_rust_crates_shlex-0 external/rust/crates/shlex/ android-12.0.0_r1-0
        download_release external_rust_crates_syn-3 external/rust/crates/syn/ android-12.0.0_r1-3
        download_release external_rust_crates_termcolor-0 external/rust/crates/termcolor/ android-12.0.0_r1-0
        download_release external_rust_crates_thiserror-impl-4 external/rust/crates/thiserror-impl/ android-12.0.0_r1-4
        download_release external_rust_crates_tokio-macros-4 external/rust/crates/tokio-macros/ android-12.0.0_r1-4
        download_release external_rust_crates_unicode-segmentation-0 external/rust/crates/unicode-segmentation/ android-12.0.0_r1-0
        download_release external_rust_crates_unicode-width-0 external/rust/crates/unicode-width/ android-12.0.0_r1-0
        download_release external_rust_crates_unicode-xid-0 external/rust/crates/unicode-xid/ android-12.0.0_r1-0
        download_release external_rust_cxx-4 external/rust/cxx/ android-12.0.0_r1-4
        download_release external_scudo-0 external/scudo/ android-12.0.0_r1-0
        download_release external_selinux-4 external/selinux/ android-12.0.0_r1-4
        download_release external_sonic-4 external/sonic/ android-12.0.0_r1-4
        download_release external_speex-4 external/speex/ android-12.0.0_r1-4
        download_release external_strace-4 external/strace/ android-12.0.0_r1-4
        download_release external_swiftshader-4 external/swiftshader/ android-12.0.0_r1-4 --exclude="libLLVM10_swiftshader" --exclude="swiftshader_marl" --exclude="swiftshader_spirv-tools" --exclude="swiftshader_debug" --exclude="swiftshader_astc"
        rm -rf external_swiftshader-4.tar.xz
        download_release external_tinyalsa-4 external/tinyalsa/ android-12.0.0_r1-4
        download_release external_vixl-4 external/vixl/ android-12.0.0_r1-4
        download_release external_vm_tools_p9-4 external/vm_tools/p9/ android-12.0.0_r1-4
        download_release external_wayland-4 external/wayland/ android-12.0.0_r1-4
        download_release external_webp-4 external/webp/ android-12.0.0_r1-4
        download_release external_xz-embedded-4 external/xz-embedded/ android-12.0.0_r1-4
        download_release external_zlib-2 external/zlib/ android-12.0.0_r1-2
        download_release external_zopfli-4 external/zopfli/ android-12.0.0_r1-4
        download_release external_zstd-4 external/zstd/ android-12.0.0_r1-4
        download_release frameworks_av-4 frameworks/av/ android-12.0.0_r1-4
        download_release frameworks_compile_libbcc-4 frameworks/compile/libbcc/ android-12.0.0_r1-4
        download_release frameworks_native-4 frameworks/native/ android-12.0.0_r1-4
        download_release frameworks_rs-2 frameworks/rs/ android-12.0.0_r1-2
        download_release frameworks_wilhelm-4 frameworks/wilhelm/ android-12.0.0_r1-4
        download_release hardware_interfaces-4 hardware/interfaces/ android-12.0.0_r1-4
        download_release hardware_libhardware-4 hardware/libhardware/ android-12.0.0_r1-4
        download_release libnativehelper-4 libnativehelper/ android-12.0.0_r1-4
        download_release packages_inputmethods_LatinIME-4 packages/inputmethods/LatinIME/ android-12.0.0_r1-4
        download_release packages_modules_DnsResolver-4 packages/modules/DnsResolver/ android-12.0.0_r1-4
        download_release packages_modules_StatsD-4 packages/modules/StatsD/ android-12.0.0_r1-4
        download_release system_bpf-4 system/bpf/ android-12.0.0_r1-4
        download_release system_bt-4 system/bt/ android-12.0.0_r1-4
        download_release system_core-4 system/core/ android-12.0.0_r1-4
        download_release system_extras-4 system/extras/ android-12.0.0_r1-4
        download_release system_gatekeeper-4 system/gatekeeper/ android-12.0.0_r1-4
        download_release system_gsid-4 system/gsid/ android-12.0.0_r1-4
        download_release system_keymaster-4 system/keymaster/ android-12.0.0_r1-4
        download_release system_libbase-4 system/libbase/ android-12.0.0_r1-4
        download_release system_libhidl-4 system/libhidl/ android-12.0.0_r1-4
        download_release system_libhwbinder-4 system/libhwbinder/ android-12.0.0_r1-4
        download_release system_logging-4 system/logging/ android-12.0.0_r1-4
        download_release system_media-4 system/media/ android-12.0.0_r1-4
        download_release system_netd-4 system/netd/ android-12.0.0_r1-4
        download_release system_sepolicy-3 system/sepolicy/ android-12.0.0_r1-3
        download_release system_tools_mkbootimg-4 system/tools/mkbootimg/ android-12.0.0_r1-4
        download_release tools_dexter-4 tools/dexter/ android-12.0.0_r1-4
        download_release tools_security-4 tools/security/ android-12.0.0_r1-4
    - name: Start Soong
      run: |
        pushd aosp
        export TOP=$(pwd)
        cp build/make/core/root.mk Makefile
        ln -sf make/CleanSpec.mk build/ && ln -sf make/core build/
        ln -sf make/target build/ && ln -sf make/tools build/
        ln -sf build/soong/root.bp Android.bp
        mkdir -p prebuilts/go && touch prebuilts/go/.out-dir
        ln -sf $GOROOT_1_19_X64 prebuilts/go/linux-x86
        mkdir -p out/soong/.minibootstrap out/soong/.bootstrap/bin
        ln -sf $GITHUB_WORKSPACE/soong_build out/soong/.bootstrap/bin
        ln -sf $GITHUB_WORKSPACE/bpglob out/soong/.minibootstrap
        cp $GITHUB_WORKSPACE/ckati prebuilts/build-tools/linux-x86/bin
        mkdir -p prebuiltlibs && cp $GITHUB_WORKSPACE/Android.bp prebuiltlibs/
        mkdir -p prebuiltlibs && cp $GITHUB_WORKSPACE/rust_prebuilt.list prebuiltlibs/
        #mkdir -p prebuiltlibs/packages/modules/adb/proto/libadb_protos/android_x86_64_shared && cp -r prebuiltlibs/packages/modules/adb/proto/libadb_protos/android_x86_64_static/proto prebuiltlibs/packages/modules/adb/proto/libadb_protos/android_x86_64_shared/
        #mkdir -p prebuiltlibs/packages/modules/adb/proto/libapp_processes_protos_lite/android_x86_64_shared && cp -r prebuiltlibs/packages/modules/adb/proto/libapp_processes_protos_lite/android_x86_64_static/proto prebuiltlibs/packages/modules/adb/proto/libapp_processes_protos_lite/android_x86_64_shared/
        #sed -i 's/"gen"/"gen","gen\/external\/perfetto","gen\/external\/perfetto\/protos"/g' prebuiltlibs/external/perfetto/Android.bp

        sed -i 's/libLLVM_android.so"],/libLLVM_android.so"],\n}, android_x86_64: { srcs: ["libLLVM_android.so"], }, android_x86: { srcs: ["libLLVM_android.so"],/g' prebuilts/sdk/tools/Android.bp
        sed -i 's/name: "libLLVM_android",/name: "libLLVM_android",\n device_supported: true, prefer: true,/g' prebuilts/sdk/tools/Android.bp
        mv prebuiltlibs/external/llvm/libLLVM_android/android_x86_64_shared/libLLVM_android.so prebuilts/sdk/tools/
        echo "eng.buildbot.$(date '+%Y%m%d.%H%M%S')" > out/soong/build_number.txt
        GOROOT=$TOP/prebuilts/go/linux-x86 $GITHUB_WORKSPACE/soong_ui --make-mode --skip-ninja --skip-kati --skip-soong-tests --skip-write-modules -j1 TARGET_PRODUCT=aosp_x86_64 TARGET_BUILD_VARIANT=eng ALLOW_MISSING_DEPENDENCIES=true BUILD_BROKEN_DISABLE_BAZEL=1 nothing
        $GITHUB_WORKSPACE/build.sh
        du -ah -d1 out/soong |sort -h
        du -ah -d1 . |sort -h

    - name: Archive art-5.tar.xz
      uses: actions/upload-artifact@v3
      with:
        name: art-5.tar.xz
        path: aosp/art-5.tar.xz

    - uses: softprops/action-gh-release@master
      with:
        name: ${{ env.branch }}-5
        tag_name: ${{ env.branch }}-5
        files: |
          aosp/art-5.tar.xz
